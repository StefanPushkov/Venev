<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0088)http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/ -->
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="ru-RU" class="chrome  win"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<title>STM32 Воспроизведение звука. Расширение возможностей программы</title>
<script type="text/javascript" src="./STM32 Воспроизведение звука. Расширение возможностей программы_files/script.js"></script>
<link rel="stylesheet" href="./STM32 Воспроизведение звука. Расширение возможностей программы_files/style.css" type="text/css" media="screen">
<!--[if IE 6]><link rel="stylesheet" href="http://mycontroller.ru/wp-content/themes/MyController/style.ie6.css" type="text/css" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="http://mycontroller.ru/wp-content/themes/MyController/style.ie7.css" type="text/css" media="screen" /><![endif]-->
<link rel="alternate" type="application/rss+xml" title="RSS-лента My Controller" href="http://mycontroller.ru/feed/">
<link rel="alternate" type="application/atom+xml" title="Atom-лента My Controller" href="http://mycontroller.ru/feed/atom/"> 
<link rel="pingback" href="http://mycontroller.ru/xmlrpc.php">
<link rel="alternate" type="application/rss+xml" title="My Controller » Лента комментариев к «STM32 Воспроизведение звука. Расширение возможностей программы»" href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/feed/">
<link rel="stylesheet" id="msw_wpfm_scan-css" href="./STM32 Воспроизведение звука. Расширение возможностей программы_files/wordpress-file-monitor.php" type="text/css" media="all">
<link rel="stylesheet" id="bwp-syntax-css" href="./STM32 Воспроизведение звука. Расширение возможностей программы_files/bwp-syntax.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-downloadmanager-css" href="./STM32 Воспроизведение звука. Расширение возможностей программы_files/download-css.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-pagenavi-css" href="./STM32 Воспроизведение звука. Расширение возможностей программы_files/pagenavi-css.css" type="text/css" media="all">
<script type="text/javascript" src="./STM32 Воспроизведение звука. Расширение возможностей программы_files/jquery.js"></script>
<script type="text/javascript" src="./STM32 Воспроизведение звука. Расширение возможностей программы_files/bwp-syntax.js"></script>
<script type="text/javascript" src="./STM32 Воспроизведение звука. Расширение возможностей программы_files/external-tracking.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://mycontroller.ru/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://mycontroller.ru/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="STM32 Воспроизведение звука. Настройка периферии + первый звук" href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-nastroyka-dac/">
<link rel="next" title="STM32 “Конструктор компонентов” для “Генератора кода”" href="http://mycontroller.ru/stm32-generator-koda-konstruktor-komponentov/">
<meta name="generator" content="WordPress 3.3.1">
<link rel="canonical" href="./STM32 Воспроизведение звука. Расширение возможностей программы_files/STM32 Воспроизведение звука. Расширение возможностей программы.htm">
<link rel="shortlink" href="http://mycontroller.ru/?p=3226">

<link rel="stylesheet" href="./STM32 Воспроизведение звука. Расширение возможностей программы_files/wp-syntax.css" type="text/css" media="screen">
<!-- wpSpoiler Code -->
        <script type="text/javascript">
            function wpSpoilerToggle(spoiler, link, showtext, hidetext) {
                if (spoiler.style.display != 'none') {
                    spoiler.style.display = 'none';
                    link.innerHTML = showtext;
                    link.className = 'spoiler_link_show';
                } else {
                    spoiler.style.display = 'block';
                    link.innerHTML = hidetext;
                    link.className = 'spoiler_link_hide';
                }
            }
          </script>
	<link type="text/css" rel="stylesheet" href="./STM32 Воспроизведение звука. Расширение возможностей программы_files/shCore.css">
	<link type="text/css" rel="stylesheet" href="./STM32 Воспроизведение звука. Расширение возможностей программы_files/shThemeDefault.css">
<!-- Google Analytics Tracking by Google Analyticator 6.0.2: http://ronaldheft.com/code/analyticator/ -->
<script type="text/javascript">window.google_analytics_uacct = "UA-29082067-1";</script>
<script type="text/javascript">
	var analyticsFileTypes = [''];
	var analyticsEventTracking = 'enabled';
</script>
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-29082067-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	})();
</script><script type="text/javascript" async="" src="./STM32 Воспроизведение звука. Расширение возможностей программы_files/ga.js"></script>
</head>
<body>
<div id="art-page-background-simple-gradient">
</div>
<div id="art-main">
<div class="art-Sheet">
    <div class="art-Sheet-tl"></div>
    <div class="art-Sheet-tr"></div>
    <div class="art-Sheet-bl"></div>
    <div class="art-Sheet-br"></div>
    <div class="art-Sheet-tc"></div>
    <div class="art-Sheet-bc"></div>
    <div class="art-Sheet-cl"></div>
    <div class="art-Sheet-cr"></div>
    <div class="art-Sheet-cc"></div>
    <div class="art-Sheet-body">
<div class="art-Header">
    <div class="art-Header-png"></div>
    <div class="art-Header-jpeg"></div>
<div class="art-Logo">
    <h1 id="name-text" class="art-Logo-name">
        <a href="http://mycontroller.ru/">My Controller</a></h1>
    <div id="slogan-text" class="art-Logo-text">
        Изучаем микроконтроллеры STM32</div>
</div>

</div>
<div class="art-nav">
	<div class="l"></div>
	<div class="r"></div>
	<ul class="art-menu">
		<li><a href="http://mycontroller.ru/"><span class="l"></span><span class="r"></span><span class="t">Home</span></a></li><li><span class="art-menu-separator"></span></li><li class="page_item page-item-10"><a href="http://mycontroller.ru/o-sayte/"><span class="l"></span><span class="r"></span><span class="t">О сайте</span></a></li><li><span class="art-menu-separator"></span></li>
<li class="page_item page-item-186"><a href="http://mycontroller.ru/programmyi/"><span class="l"></span><span class="r"></span><span class="t">СОФТ</span></a></li>
	</ul>
</div>
<div class="art-contentLayout">
<div class="art-content">

<div class="art-Post">
    <div class="art-Post-tl"></div>
    <div class="art-Post-tr"></div>
    <div class="art-Post-bl"></div>
    <div class="art-Post-br"></div>
    <div class="art-Post-tc"></div>
    <div class="art-Post-bc"></div>
    <div class="art-Post-cl"></div>
    <div class="art-Post-cr"></div>
    <div class="art-Post-cc"></div>
    <div class="art-Post-body">
<div class="art-Post-inner art-article">

<div class="art-PostContent">

<div class="navigation">
	<div class="alignleft">« <a href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-nastroyka-dac/" rel="prev">STM32 Воспроизведение звука. Настройка периферии + первый звук</a></div>
	<div class="alignright"><a href="http://mycontroller.ru/stm32-generator-koda-konstruktor-komponentov/" rel="next">STM32 “Конструктор компонентов” для “Генератора кода”</a> »</div>
</div>

</div>
<div class="cleared"></div>


</div>

		<div class="cleared"></div>
    </div>
</div>

<div class="art-Post">
    <div class="art-Post-tl"></div>
    <div class="art-Post-tr"></div>
    <div class="art-Post-bl"></div>
    <div class="art-Post-br"></div>
    <div class="art-Post-tc"></div>
    <div class="art-Post-bc"></div>
    <div class="art-Post-cl"></div>
    <div class="art-Post-cr"></div>
    <div class="art-Post-cc"></div>
    <div class="art-Post-body">
<div class="art-Post-inner art-article">
<h2 class="art-PostHeader">
<a href="./STM32 Воспроизведение звука. Расширение возможностей программы_files/STM32 Воспроизведение звука. Расширение возможностей программы.htm" rel="bookmark" title="Постоянная ссылка на STM32 Воспроизведение звука. Расширение возможностей программы">
STM32 Воспроизведение звука. Расширение возможностей программы</a>
</h2>
<div class="art-PostContent">

          <p>В предыдущей статье приводился пример того, как можно воспроизвести звук с помощью STM32. Пришло время расширить возможности этой программы, но прежде давайте определимся: для чего это нужно. Не проще ли купить недорогой китайский mp3-проигрыватель. Его возможности будут больше, да и цена…</p>
<p>Конечно, соревноваться китайпромом бесполезно. Если нужен проигрыватель, то лучше его купить. Но у нас задача другая. Во-первых, сможем ближе познакомиться с возможностями контроллера. Во-вторых, можно будет это устройство использовать там, где обычный проигрыватель сложно применить. </p>
<p>Например, недавно я сделал по заказу GSM-сигнализацию. Работает она исправно, но общается с пользователем через смс-ки, что не всегда удобно. Заказчик хочет, чтобы она могла “говорить”. Сработал датчик –&gt; звонок пользователю –&gt; голосовое сообщение “сработал такой-то датчик”.</p>
<p>Еще одно применение -&nbsp; сделать небольшой модуль, состоящий из контроллера и карты памяти. Этот модуль можно подключать к устройству по USART, через который передавать команды для воспроизведения слов, фраз, предложений. Таким образом можно <em>озвучить</em> разные устройства. </p>
<p>Не будем забывать о проекте “Умный дом”. Для этого проекта воспроизведение звука <strike>желательно</strike> необходимо. Поэтому займемся усовершенствованием программы для ее дальнейшего практического применения. Назовем ее <strong>“Wave Player”</strong>, или сокращенно <strong>WP</strong>. Соответственно все функции, относящиеся к ней, будут иметь префикс <strong>wp</strong>.</p>
<p><span id="more-3226"></span>
</p><p>Для начала, научим “Wave Player” понимать заголовок файла, в котором указан формат данных.</p>
<p>Для этого понадобиться структура, которая будет хранить информацию о формате данных:</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">typedef</span> <span style="color: #993333;">struct</span>
<span style="color: #009900;">{</span>
  <span style="color: #993333;">uint8_t</span>  Channels<span style="color: #339933;">;</span>          <span style="color: #666666; font-style: italic;">//количество каналов                                             /</span>
  <span style="color: #993333;">uint16_t</span> SamplesPerSec<span style="color: #339933;">;</span>     <span style="color: #666666; font-style: italic;">//частота дискретизации аудиосигнала, Гц</span>
  <span style="color: #993333;">uint8_t</span>  BitsPerSample      <span style="color: #666666; font-style: italic;">//разрядность данных (8,16)</span>
  <span style="color: #993333;">uint32_t</span> Size<span style="color: #339933;">;</span>              <span style="color: #666666; font-style: italic;">//количество полезных данных, байт  </span>
  <span style="color: #993333;">uint16_t</span> AvgBytesPerSec<span style="color: #339933;">;</span>    <span style="color: #666666; font-style: italic;">//количество байт в секунду (поток данных)</span>
<span style="color: #009900;">}</span> wp_format<span style="color: #339933;">;</span></pre></td></tr></tbody></table></div>

<p>Первые три параметра нужны для настройки преобразования данных. Благодаря двум последним можно, например, вычислить время воспроизведения всего файла (в секундах): t = Size / AvgBytesPerSec</p>
<p>Еще понадобится перечисленный тип данных, который будет использоваться для определения возвращаемых функциями значений:</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">/*                значения, которые могут возвращать функции                                 */</span>
<span style="color: #993333;">typedef</span> <span style="color: #000000; font-weight: bold;">enum</span>
<span style="color: #009900;">{</span>
  WP_OK <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span>                  <span style="color: #666666; font-style: italic;">//файл успешно воспроизведен</span>
  WP_ERROR_FILE<span style="color: #339933;">,</span>              <span style="color: #666666; font-style: italic;">//файл не открыт (не найден, не верный формат и т.п.)</span>
  WP_ERROR_READ_FILE<span style="color: #339933;">,</span>         <span style="color: #666666; font-style: italic;">//возникла ошибка чтения при воспроизведении открытого файла</span>
  WP_STOP<span style="color: #339933;">,</span>                    <span style="color: #666666; font-style: italic;">//воспроизведение было остановлено программно, файл закрыт</span>
  WP_PAUSE<span style="color: #339933;">,</span>                   <span style="color: #666666; font-style: italic;">//пауза воспроизведения</span>
  WP_PLAY<span style="color: #339933;">,</span>                    <span style="color: #666666; font-style: italic;">//возобновить воспроизведение</span>
  WP_NONE<span style="color: #339933;">,</span>                    <span style="color: #666666; font-style: italic;">//</span>
  WP_ERROR                    <span style="color: #666666; font-style: italic;">//просто ошибка</span>
<span style="color: #009900;">}</span>WPRESULT<span style="color: #339933;">;</span></pre></td></tr></tbody></table></div>

<p>Создадим функцию <strong>wp_open</strong>, которая будет открывать требуемый файл, читать его заголовок и загружать данные о формате данных в структуру wp_format. При успешном открытии файла и прочтении заголовка функция будет возвращать 0, иначе (например, не поддерживаемый формат данных) файл будет закрыт и функция вернет значение, отличное от нуля.&nbsp;&nbsp; </p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #666666; font-style: italic;">//function открывает файл и заполняет структуру формата данных format                       //</span>
<span style="color: #666666; font-style: italic;">//argument указатель на файловую структуру, имя файла, указатель на структуру формата данных//</span>
<span style="color: #666666; font-style: italic;">//result   файл открыт нормально, ошибка открытия                                           //</span>
<span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
WPRESULT wp_open<span style="color: #009900;">(</span> FIL <span style="color: #339933;">*</span>file<span style="color: #339933;">,</span>  <span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>FileName<span style="color: #339933;">,</span> wp_format <span style="color: #339933;">*</span>format <span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
  <span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span> res<span style="color: #339933;">;</span>                          <span style="color: #666666; font-style: italic;">//для хранения результата</span>
  <span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">64</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>                     <span style="color: #666666; font-style: italic;">//буфер для заголовка файла</span>
  <span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span> cnt<span style="color: #339933;">;</span>                          <span style="color: #666666; font-style: italic;">//количество прочитанных байт</span>
  <span style="color: #993333;">unsigned</span> <span style="color: #993333;">long</span> i<span style="color: #339933;">;</span>                            <span style="color: #666666; font-style: italic;">//вспом. переменная</span>
&nbsp;
  res <span style="color: #339933;">=</span> f_open <span style="color: #009900;">(</span> file<span style="color: #339933;">,</span> FileName<span style="color: #339933;">,</span> FA_READ <span style="color: #009900;">)</span><span style="color: #339933;">;</span>   <span style="color: #666666; font-style: italic;">//открыть файл для чтения</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>res<span style="color: #009900;">)</span> <span style="color: #b1b100;">return</span> WP_ERROR_FILE<span style="color: #339933;">;</span>               <span style="color: #666666; font-style: italic;">//ошибка открытия</span>
  res <span style="color: #339933;">=</span> f_read <span style="color: #009900;">(</span> file<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">0</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">64</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>cnt <span style="color: #009900;">)</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;">//загрузить первые 64 байт</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>res <span style="color: #339933;">||</span> cnt<span style="color: #339933;">!=</span><span style="color: #0000dd;">64</span><span style="color: #009900;">)</span> <span style="color: #b1b100;">return</span> WP_ERROR_FILE<span style="color: #339933;">;</span>    <span style="color: #666666; font-style: italic;">//ошибка чтения</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//байты 0..3 - должен быть маркер "RIFF"</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">0</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'R'</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">1</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'I'</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">2</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'F'</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">3</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'F'</span><span style="color: #009900;">)</span>     res <span style="color: #339933;">=</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//байты 8..11 - должен быть маркер "WAVE"</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">8</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'W'</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">9</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'A'</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">10</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'V'</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">11</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'E'</span><span style="color: #009900;">)</span>   res <span style="color: #339933;">=</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//байты 12..15 - должен быть маркер "fmt "</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">12</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'f'</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">13</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'m'</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">14</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'t'</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">15</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">' '</span><span style="color: #009900;">)</span> res <span style="color: #339933;">=</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//байты 20,21  - 1 и 0</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">20</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #0000dd;">1</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">21</span><span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #0000dd;">0</span><span style="color: #009900;">)</span> res <span style="color: #339933;">=</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//вычислить размер чанка "fmt "</span>
  i <span style="color: #339933;">=</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">16</span><span style="color: #009900;">]</span> <span style="color: #339933;">|</span> <span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">17</span><span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">8</span><span style="color: #009900;">)</span> <span style="color: #339933;">|</span> <span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">18</span><span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">16</span><span style="color: #009900;">)</span> <span style="color: #339933;">|</span> <span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">19</span><span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">24</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//после чанка "fmt " должен следовать чанк "data"</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">20</span><span style="color: #339933;">+</span>i<span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'d'</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">21</span><span style="color: #339933;">+</span>i<span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'a'</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">22</span><span style="color: #339933;">+</span>i<span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'t'</span> <span style="color: #339933;">||</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">23</span><span style="color: #339933;">+</span>i<span style="color: #009900;">]</span><span style="color: #339933;">!=</span><span style="color: #ff0000;">'a'</span><span style="color: #009900;">)</span> res <span style="color: #339933;">=</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>res<span style="color: #339933;">==</span><span style="color: #0000dd;">2</span><span style="color: #009900;">)</span>
  <span style="color: #009900;">{</span>
    f_close<span style="color: #009900;">(</span>file<span style="color: #009900;">)</span><span style="color: #339933;">;</span>                          <span style="color: #666666; font-style: italic;">//закрыть файл</span>
    <span style="color: #b1b100;">return</span> WP_ERROR_FILE<span style="color: #339933;">;</span>                   <span style="color: #666666; font-style: italic;">//ошибка формата файла</span>
  <span style="color: #009900;">}</span>
&nbsp;
  <span style="color: #808080; font-style: italic;">/*                    Загрузить формат данных                        */</span>
  format<span style="color: #339933;">-&gt;</span>Channels       <span style="color: #339933;">=</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">22</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
  format<span style="color: #339933;">-&gt;</span>SamplesPerSec  <span style="color: #339933;">=</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">24</span><span style="color: #009900;">]</span> <span style="color: #339933;">|</span> <span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">25</span><span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">8</span><span style="color: #009900;">)</span> <span style="color: #339933;">|</span> <span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">26</span><span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">16</span><span style="color: #009900;">)</span> <span style="color: #339933;">|</span> <span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">27</span><span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">24</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
  format<span style="color: #339933;">-&gt;</span>AvgBytesPerSec <span style="color: #339933;">=</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">28</span><span style="color: #009900;">]</span> <span style="color: #339933;">|</span> <span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">29</span><span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">8</span><span style="color: #009900;">)</span> <span style="color: #339933;">|</span> <span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">30</span><span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">16</span><span style="color: #009900;">)</span> <span style="color: #339933;">|</span> <span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">31</span><span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">24</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
  format<span style="color: #339933;">-&gt;</span>BitsPerSample  <span style="color: #339933;">=</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">34</span><span style="color: #009900;">]</span> <span style="color: #339933;">|</span> <span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">35</span><span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">8</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
  format<span style="color: #339933;">-&gt;</span>Size           <span style="color: #339933;">=</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">24</span><span style="color: #339933;">+</span>i<span style="color: #009900;">]</span><span style="color: #339933;">|</span><span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">25</span><span style="color: #339933;">+</span>i<span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">8</span><span style="color: #009900;">)</span><span style="color: #339933;">|</span><span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">26</span><span style="color: #339933;">+</span>i<span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">16</span><span style="color: #009900;">)</span><span style="color: #339933;">|</span><span style="color: #009900;">(</span>buff<span style="color: #009900;">[</span><span style="color: #0000dd;">27</span><span style="color: #339933;">+</span>i<span style="color: #009900;">]</span><span style="color: #339933;">&lt;&lt;</span><span style="color: #0000dd;">24</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//файловый указатель на начало данных</span>
  f_lseek<span style="color: #009900;">(</span>file<span style="color: #339933;">,</span>i<span style="color: #339933;">+</span><span style="color: #0000dd;">28</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">return</span> WP_OK<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Небольшое пояснение к листингу функции wp_open:</p>
<ul>
<li>Строки 13..16 – открываем файл и загружаем первые 64 байта в буфер. </li>
<li>Строки 19..25 – убеждаемся, что это WAV-файл. </li>
<li>Строка 31 – вычисляем положение начала чанка “data”, в нем содержаться полезные данные. </li>
<li>Строка 34 – убеждаемся, что чанк “data” действительно присутствует в нужном месте. </li>
<li>Строки 43..47 – считываем информацию о формате данных в структуру по указателю format. </li>
<li>Строка 50 – устанавливаем файловый указатель в позицию, с которой начинаются аудио данные. </li>
</ul>
<p>Функция wp_open заполнит структуру, по которой необходимо настроить преобразователь цифровых данных в аналоговый сигнал. Здесь под преобразователем подразумевается не только сам модуль DAC, но и модули, обслуживающие его: ДМА и таймер.</p>
<p>Следующий шаг – создание функции,&nbsp; выполняющей настройку преобразователя. Назовем эту функцию <strong>wp_init</strong>. Ей в качестве аргумента будет передаваться указатель на структуру, содержащей информацию о формате данных. </p>
<p>Прежде, чем создать функцию, определимся с возможностями нашего “Wave Player”. Для начала наделим его следующими возможностями:</p>
<ul>
<li>воспроизведение&nbsp; монофонического сигнала; </li>
<li>разная частотой дискретизации; </li>
<li>данные разрядностью 8 бит; </li>
<li>управление процессом воспроизведения – пауза, воспроизведение, стоп </li>
</ul>
<p><font color="#0a1c1f">Как видим, одно из ограничений – пока только монофонического сигнала. Почему так? Во-первых, wav-файлы имеют приличный объем, а для стереосигнала потребуется в два раза больший объем. Во-вторых, цель не в том, чтобы создать hi-end проигрыватель. Задачи у нас более приземленные, для которых достаточно одного канала.</font></p>
<p><font color="#0a1c1f">Почему только 8 бит? Для первой модернизации этого будет вполне достаточно.</font></p>
<p><font color="#0a1c1f">Учитывая оговоренные требования, напишем функцию, которая будет инициализировать преобразователь:</font></p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#define SIZE_DAC_BUFF  512                  //размер буфера в байтах</span>
<span style="color: #339933;">#define FREQ_CLK       24000000             //тактовая частота, Гц (в моем случае 24000000Гц )</span>
&nbsp;
<span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span> DAC_Buff<span style="color: #009900;">[</span>SIZE_DAC_BUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>      <span style="color: #666666; font-style: italic;">//буфер данных ЦАПа</span>
&nbsp;
<span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #666666; font-style: italic;">//function настраивает преобразователь под выбранный формат данных                          //</span>
<span style="color: #666666; font-style: italic;">//argument указатель на структуру, содержащей информацию о формате данных                   //</span>
<span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #993333;">void</span> wp_init <span style="color: #009900;">(</span>wp_format <span style="color: #339933;">*</span>format<span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
  <span style="color: #993333;">static</span> <span style="color: #993333;">char</span> StartInit <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>                     <span style="color: #666666; font-style: italic;">//признак стартовой инициализации</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//При первом обращении к функции выполнить стартовую инициализацию</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>StartInit<span style="color: #339933;">==</span><span style="color: #0000dd;">0</span><span style="color: #009900;">)</span>
  <span style="color: #009900;">{</span>
    <span style="color: #666666; font-style: italic;">//Настраиваем первый канал ЦАПа для приема данных от ДМА</span>
    RCC<span style="color: #339933;">-&gt;</span>APB2ENR        <span style="color: #339933;">|=</span> RCC_APB2ENR_IOPAEN<span style="color: #339933;">;</span>     <span style="color: #666666; font-style: italic;">//тактирование линий GPIOA</span>
    RCC<span style="color: #339933;">-&gt;</span>APB1ENR        <span style="color: #339933;">|=</span> RCC_APB1ENR_DACEN<span style="color: #339933;">;</span>      <span style="color: #666666; font-style: italic;">//тактирование ЦАПа</span>
    DAC<span style="color: #339933;">-&gt;</span>CR             <span style="color: #339933;">|=</span> DAC_CR_DMAEN1<span style="color: #339933;">;</span>          <span style="color: #666666; font-style: italic;">//разрешить прием данных канала №1 от ДМА</span>
    DAC<span style="color: #339933;">-&gt;</span>CR             <span style="color: #339933;">|=</span> DAC_CR_BOFF1<span style="color: #339933;">;</span>           <span style="color: #666666; font-style: italic;">//отключить выходной буфер</span>
    DAC<span style="color: #339933;">-&gt;</span>CR             <span style="color: #339933;">|=</span> DAC_CR_EN1<span style="color: #339933;">;</span>             <span style="color: #666666; font-style: italic;">//включить канал 1</span>
    <span style="color: #666666; font-style: italic;">//Настроить 3-й канал ДМА для работы с ЦАПом</span>
    RCC<span style="color: #339933;">-&gt;</span>AHBENR         <span style="color: #339933;">|=</span> RCC_AHBENR_DMA1EN<span style="color: #339933;">;</span>      <span style="color: #666666; font-style: italic;">//тактирование DMA</span>
    DMA1_Channel3<span style="color: #339933;">-&gt;</span>CMAR  <span style="color: #339933;">=</span> <span style="color: #009900;">(</span><span style="color: #993333;">uint32_t</span><span style="color: #009900;">)</span><span style="color: #339933;">&amp;</span>DAC_Buff<span style="color: #009900;">[</span><span style="color: #0000dd;">0</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//указатель на начало буфера в памяти</span>
    DMA1_Channel3<span style="color: #339933;">-&gt;</span>CCR   <span style="color: #339933;">=</span>  DMA_CCR3_DIR<span style="color: #339933;">;</span>          <span style="color: #666666; font-style: italic;">//передача из памяти в периферию</span>
    DMA1_Channel3<span style="color: #339933;">-&gt;</span>CCR  <span style="color: #339933;">&amp;=</span> ~DMA_CCR3_PINC<span style="color: #339933;">;</span>         <span style="color: #666666; font-style: italic;">//адрес периферии не инкрементируем</span>
    DMA1_Channel3<span style="color: #339933;">-&gt;</span>CCR  <span style="color: #339933;">|=</span>  DMA_CCR3_MINC<span style="color: #339933;">;</span>         <span style="color: #666666; font-style: italic;">//адрес памяти инкрементируем</span>
    DMA1_Channel3<span style="color: #339933;">-&gt;</span>CCR  <span style="color: #339933;">|=</span>  DMA_CCR3_CIRC<span style="color: #339933;">;</span>         <span style="color: #666666; font-style: italic;">//включить циклический режим передачи данных</span>
    <span style="color: #666666; font-style: italic;">//Запуск передачи очередного значения через ДМА будет происходить от TIM6</span>
    RCC<span style="color: #339933;">-&gt;</span>APB1ENR        <span style="color: #339933;">|=</span>  RCC_APB1ENR_TIM6EN<span style="color: #339933;">;</span>    <span style="color: #666666; font-style: italic;">//подаем тактирование TIM6</span>
    TIM6<span style="color: #339933;">-&gt;</span>PSC            <span style="color: #339933;">=</span>  <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>                     <span style="color: #666666; font-style: italic;">//предделитель не используем (кофф =1)</span>
    TIM6<span style="color: #339933;">-&gt;</span>DIER          <span style="color: #339933;">|=</span>  TIM_DIER_UDE<span style="color: #339933;">;</span>          <span style="color: #666666; font-style: italic;">//разрешить запрос DMA при обновлении</span>
    <span style="color: #666666; font-style: italic;">//Стартовая инициализация выполнена, устанавливам признак этого</span>
    StartInit            <span style="color: #339933;">=</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">}</span>
&nbsp;
  DMA1_Channel3<span style="color: #339933;">-&gt;</span>CCR  <span style="color: #339933;">&amp;=</span> ~DMA_CCR3_EN<span style="color: #339933;">;</span>           <span style="color: #666666; font-style: italic;">//отключить третий канал DMA</span>
  DMA1_Channel3<span style="color: #339933;">-&gt;</span>CPAR  <span style="color: #339933;">=</span> <span style="color: #009900;">(</span><span style="color: #993333;">uint32_t</span><span style="color: #009900;">)</span><span style="color: #339933;">&amp;</span>DAC<span style="color: #339933;">-&gt;</span>DHR8R1<span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">//указатель на регистр-приемник</span>
  DMA1_Channel3<span style="color: #339933;">-&gt;</span>CNDTR <span style="color: #339933;">=</span> SIZE_DAC_BUFF<span style="color: #339933;">;</span>          <span style="color: #666666; font-style: italic;">//размер буфера</span>
  DMA1_Channel3<span style="color: #339933;">-&gt;</span>CCR  <span style="color: #339933;">|=</span>  DMA_CCR3_EN<span style="color: #339933;">;</span>           <span style="color: #666666; font-style: italic;">//разрешаем работу третьего канала DMA</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//задаем частоту дискретизации</span>
  TIM6<span style="color: #339933;">-&gt;</span>ARR <span style="color: #339933;">=</span> <span style="color: #009900;">(</span><span style="color: #993333;">uint32_t</span><span style="color: #009900;">)</span>FREQ_CLK <span style="color: #339933;">/</span> format<span style="color: #339933;">-&gt;</span>SamplesPerSec<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Думаю, листинг функции в особых комментариях не нуждается. Строки с 15 по 38 — первоначальная инициализация преобразователя, которая выполняется всего один раз, при первом вызове функции.</p>
<p>Строка 42 – настраиваем таймер на требуемую частоту дискретизации. Этот параметр корректируется каждый раз при вызове функции, так как он может отличаться от файла к файлу.</p>
<p>И наконец функция <strong>wp_play</strong>, которая будет выполнять проигрывание файла:</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #666666; font-style: italic;">//function воспроизводит требуемый файл                                                     //</span>
<span style="color: #666666; font-style: italic;">//argument имя файла(с указанием пути к нему)                                               //</span>
<span style="color: #666666; font-style: italic;">//result   смотри значения WPRESULT в заголовочном файле                                    //</span>
<span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
WPRESULT wp_play <span style="color: #009900;">(</span> <span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>FileName <span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
  FIL           file<span style="color: #339933;">;</span>                       <span style="color: #666666; font-style: italic;">//файловая переменная</span>
  wp_format     format<span style="color: #339933;">;</span>                     <span style="color: #666666; font-style: italic;">//хранит инфу о формате звуковых данных</span>
  <span style="color: #993333;">unsigned</span> <span style="color: #993333;">int</span> cnt<span style="color: #339933;">;</span>                        <span style="color: #666666; font-style: italic;">//для хранения количества прочитанных байт</span>
  WPRESULT      res<span style="color: #339933;">;</span>
&nbsp;
  res <span style="color: #339933;">=</span> wp_open<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>file<span style="color: #339933;">,</span> FileName<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>format<span style="color: #009900;">)</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;">//открыть файл для воспроизведения</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>res<span style="color: #009900;">)</span> <span style="color: #b1b100;">return</span> WP_ERROR_FILE<span style="color: #339933;">;</span>             <span style="color: #666666; font-style: italic;">//ошибка открытия файла</span>
&nbsp;
  wp_init<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>format<span style="color: #009900;">)</span><span style="color: #339933;">;</span>                         <span style="color: #666666; font-style: italic;">//настроить преобразователь согласно формату</span>
&nbsp;
  <span style="color: #808080; font-style: italic;">/*     Загрузить весь буфер ЦАПа данными из файла и запустить проигрывание     */</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span> f_read <span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>file<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>DAC_Buff<span style="color: #009900;">[</span><span style="color: #0000dd;">0</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span> SIZE_DAC_BUFF<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>cnt<span style="color: #009900;">)</span> <span style="color: #009900;">)</span>
  <span style="color: #009900;">{</span>
    f_close<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>file<span style="color: #009900;">)</span><span style="color: #339933;">;</span>                         <span style="color: #666666; font-style: italic;">//ошибка при чтении!!! Закрываем файл</span>
    <span style="color: #b1b100;">return</span> WP_ERROR_READ_FILE<span style="color: #339933;">;</span>              <span style="color: #666666; font-style: italic;">//и выходим</span>
  <span style="color: #009900;">}</span>
&nbsp;
  WP_ENABLE                                 <span style="color: #666666; font-style: italic;">//запустить преобразование</span>
&nbsp;
  <span style="color: #808080; font-style: italic;">/*                  Воспроизведение файла                  */</span>
  <span style="color: #b1b100;">while</span><span style="color: #009900;">(</span><span style="color: #0000dd;">1</span><span style="color: #009900;">)</span>
  <span style="color: #009900;">{</span>
    <span style="color: #b1b100;">while</span><span style="color: #009900;">(</span><span style="color: #339933;">!</span><span style="color: #009900;">(</span>DMA1<span style="color: #339933;">-&gt;</span>ISR <span style="color: #339933;">&amp;</span> DMA_ISR_HTIF3<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>      <span style="color: #666666; font-style: italic;">//ждем освобождение первой части буфера</span>
    DMA1<span style="color: #339933;">-&gt;</span>IFCR <span style="color: #339933;">|=</span> DMA_ISR_HTIF3<span style="color: #339933;">;</span>              <span style="color: #666666; font-style: italic;">//сбросить флаг</span>
    <span style="color: #666666; font-style: italic;">//заполнить освободившуюся часть буфера</span>
    res <span style="color: #339933;">=</span> f_read <span style="color: #009900;">(</span> <span style="color: #339933;">&amp;</span>file<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>DAC_Buff<span style="color: #009900;">[</span><span style="color: #0000dd;">0</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span> SIZE_DAC_BUFF<span style="color: #339933;">/</span><span style="color: #0000dd;">2</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>cnt <span style="color: #009900;">)</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>res<span style="color: #009900;">)</span> <span style="color: #009900;">{</span>res <span style="color: #339933;">=</span> WP_ERROR_READ_FILE<span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><span style="color: #009900;">}</span><span style="color: #666666; font-style: italic;">//ошибка при чтении!!!</span>
    <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>cnt<span style="color: #339933;">&lt;</span>SIZE_DAC_BUFF<span style="color: #339933;">/</span><span style="color: #0000dd;">2</span><span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>            <span style="color: #666666; font-style: italic;">//файл закончился</span>
&nbsp;
    <span style="color: #b1b100;">while</span><span style="color: #009900;">(</span><span style="color: #339933;">!</span><span style="color: #009900;">(</span>DMA1<span style="color: #339933;">-&gt;</span>ISR <span style="color: #339933;">&amp;</span> DMA_ISR_TCIF3<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>      <span style="color: #666666; font-style: italic;">//ждем освобождение второй части буфера</span>
    DMA1<span style="color: #339933;">-&gt;</span>IFCR <span style="color: #339933;">|=</span> DMA_ISR_TCIF3<span style="color: #339933;">;</span>              <span style="color: #666666; font-style: italic;">//сбросить флаг</span>
    <span style="color: #666666; font-style: italic;">//заполнить освободившуюся часть буфера</span>
    res <span style="color: #339933;">=</span> f_read <span style="color: #009900;">(</span> <span style="color: #339933;">&amp;</span>file<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>DAC_Buff<span style="color: #009900;">[</span>SIZE_DAC_BUFF<span style="color: #339933;">/</span><span style="color: #0000dd;">2</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span> SIZE_DAC_BUFF<span style="color: #339933;">/</span><span style="color: #0000dd;">2</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>cnt <span style="color: #009900;">)</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>res<span style="color: #009900;">)</span> <span style="color: #009900;">{</span>res <span style="color: #339933;">=</span> WP_ERROR_READ_FILE<span style="color: #339933;">;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span><span style="color: #009900;">}</span><span style="color: #666666; font-style: italic;">//ошибка при чтении!!!</span>
    <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>cnt<span style="color: #339933;">&lt;</span>SIZE_DAC_BUFF<span style="color: #339933;">/</span><span style="color: #0000dd;">2</span><span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>            <span style="color: #666666; font-style: italic;">//файл закончился</span>
&nbsp;
    <span style="color: #666666; font-style: italic;">//управление процессом воспроизведения</span>
    res <span style="color: #339933;">=</span> wp_control<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>res<span style="color: #339933;">!=</span>WP_NONE<span style="color: #009900;">)</span>
    <span style="color: #009900;">{</span>
      <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>res<span style="color: #339933;">==</span>WP_PAUSE<span style="color: #009900;">)</span>                       <span style="color: #666666; font-style: italic;">//сделать паузу</span>
      <span style="color: #009900;">{</span>
         WP_DISABLE<span style="color: #339933;">;</span>                          <span style="color: #666666; font-style: italic;">//остановить преобразование</span>
         <span style="color: #b1b100;">while</span><span style="color: #009900;">(</span>res<span style="color: #339933;">!=</span>WP_PLAY<span style="color: #339933;">&amp;&amp;</span>res<span style="color: #339933;">!=</span>WP_STOP<span style="color: #009900;">)</span>    <span style="color: #666666; font-style: italic;">//ожидать play или stop</span>
         res <span style="color: #339933;">=</span> wp_control<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
      <span style="color: #009900;">}</span>
      <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>res<span style="color: #339933;">==</span>WP_STOP<span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>                 <span style="color: #666666; font-style: italic;">//была команда стоп, закрываем файл</span>
      WP_ENABLE<span style="color: #339933;">;</span>                              <span style="color: #666666; font-style: italic;">//возобновить преобразование</span>
    <span style="color: #009900;">}</span>
  <span style="color: #009900;">}</span>
&nbsp;
  WP_DISABLE                                  <span style="color: #666666; font-style: italic;">//остановить преобразование</span>
  f_close<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>file<span style="color: #009900;">)</span><span style="color: #339933;">;</span>                             <span style="color: #666666; font-style: italic;">//закрыть файл перед выходом</span>
  <span style="color: #b1b100;">return</span> res<span style="color: #339933;">;</span>                                 <span style="color: #666666; font-style: italic;">//возвратить результат</span>
&nbsp;
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Строка 13 — открываем файл и читаем его заголовок.<br>
Строка 16 — настраиваем преобразователь согласно прочитанным данным.<br>
Строка 19 — загружаем весь буфер полезными данными.<br>
Строка 25 — запускаем преобразование. После этого пойдет звук.<br>
Строки 28..57 — процесс воспроизведения всего файла. Принцип такой: ждем освобождения первой половины буфера. Когда освободится, загружаем ее данными, и делаем то же для второй половины.<br>
Об окончании файла узнаем, когда прочитанных из файла данных будет меньше запрошенных для чтения(строки 35 и 42).<br>
По окончанию останавливаем преобразователь и закрываем файл (строки 59 и 60).<br>
Для управления процессом воспроизведения предназначены строки 45..56. Возможна приостановка воспроизведения (PAUSE), возобновление воспроизведения (PLAY) и остановка с закрытием файла (STOP). Для задания требуемого действия предназначена фнукция wp_control:</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #666666; font-style: italic;">//function управление процессом воспроизведения                                             //</span>
<span style="color: #666666; font-style: italic;">//result   требуемое действие                                                               //</span>
<span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
WPRESULT wp_control<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
  <span style="color: #808080; font-style: italic;">/*Здесь можно написать код для управления воспроизведением.
    Например, при нажатии кнопки №1 вернуть WP_PAUSE
    при нажатии кнопки №2 вернуть WP_PLAY
    при нажатии кнопки №3 вернуть WP_STOP
  */</span>
&nbsp;
  <span style="color: #b1b100;">return</span> WP_NONE<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Это все нужные нам функции. Воспроизведение файла будет выглядеть следующим образом:</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
</pre></td><td class="code"><pre class="c" style="font-family:monospace;">.......                         <span style="color: #666666; font-style: italic;">//что-то делаем</span>
f_mount<span style="color: #009900;">(</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>fs<span style="color: #009900;">)</span><span style="color: #339933;">;</span>                <span style="color: #666666; font-style: italic;">//монтируем диск</span>
.......                         <span style="color: #666666; font-style: italic;">//что-то делаем                                               /</span>
wp_play<span style="color: #009900;">(</span><span style="color: #ff0000;">"0:sound.wav"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>         <span style="color: #666666; font-style: italic;">//воспроизводим файл</span></pre></td></tr></tbody></table></div>

<p>На этом первое усовершенствование программы закончено.<br>
Скачать файлы WavePlayer.c и WavePlayer.h можно здесь: <a href="http://mycontroller.ru/downloads/WP.rar?id=5">скачать</a></p>
                  
</div>
<div class="cleared"></div>
<div class="art-PostFooterIcons art-metadata-icons">
Рубрика: <a href="http://mycontroller.ru/category/bez-rubriki/waveplayer/" title="Просмотреть все записи в рубрике «WavePlayer»" rel="category tag">WavePlayer</a>, <a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/" title="Просмотреть все записи в рубрике «МИКРОКОНТРОЛЛЕРЫ STM32»" rel="category tag">МИКРОКОНТРОЛЛЕРЫ STM32</a>
</div>

</div>

		<div class="cleared"></div>
    </div>
</div>


<!-- You can start editing here. -->


<div class="art-Post">
    <div class="art-Post-tl"></div>
    <div class="art-Post-tr"></div>
    <div class="art-Post-bl"></div>
    <div class="art-Post-br"></div>
    <div class="art-Post-tc"></div>
    <div class="art-Post-bc"></div>
    <div class="art-Post-cl"></div>
    <div class="art-Post-cr"></div>
    <div class="art-Post-cc"></div>
    <div class="art-Post-body">
<div class="art-Post-inner art-article">

<div class="art-PostContent">

<h3 id="comments">Комментарии (4) на “STM32 Воспроизведение звука. Расширение возможностей программы”</h3>



</div>
<div class="cleared"></div>


</div>

		<div class="cleared"></div>
    </div>
</div>


	<ul class="commentlist">
       <li class="comment even thread-even depth-1" id="li-comment-1159">
     <div id="comment-1159">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Vladimir:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/#comment-1159">18.09.2012 в 18:41</a></div>

      <p>Линк исправте на RU вместо COM :)</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/?replytocom=1159#respond" onclick="return addComment.moveForm(&quot;comment-1159&quot;, &quot;1159&quot;, &quot;respond&quot;, &quot;3226&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment odd alt depth-2" id="li-comment-1164">
     <div id="comment-1164">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Vladimir:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/#comment-1164">19.09.2012 в 08:06</a></div>

      <p>э.. Исправте ещё раз тот линк — перекидывает «mycontroller/downloads/WP.rar»</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/?replytocom=1164#respond" onclick="return addComment.moveForm(&quot;comment-1164&quot;, &quot;1164&quot;, &quot;respond&quot;, &quot;3226&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor even depth-3" id="li-comment-1173">
     <div id="comment-1173">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/#comment-1173">19.09.2012 в 13:58</a></div>

      <p>Исправил. Попробуйте закачать</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/?replytocom=1173#respond" onclick="return addComment.moveForm(&quot;comment-1173&quot;, &quot;1173&quot;, &quot;respond&quot;, &quot;3226&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
</ul>
</li>
</ul>
</li>
   <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2279">
     <div id="comment-2279">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn"><a href="http://ya.ru/" rel="external nofollow" class="url">Alex</a>:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/#comment-2279">28.11.2012 в 07:09</a></div>

      <p>Хотелось бы увидеть по ссылке законченный проект — и main, и звуковую и fat-части…<br>
Спасибо.</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/?replytocom=2279#respond" onclick="return addComment.moveForm(&quot;comment-2279&quot;, &quot;2279&quot;, &quot;respond&quot;, &quot;3226&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
  </ul>


 

<div class="art-Post">
    <div class="art-Post-tl"></div>
    <div class="art-Post-tr"></div>
    <div class="art-Post-bl"></div>
    <div class="art-Post-br"></div>
    <div class="art-Post-tc"></div>
    <div class="art-Post-bc"></div>
    <div class="art-Post-cl"></div>
    <div class="art-Post-cr"></div>
    <div class="art-Post-cc"></div>
    <div class="art-Post-body">
<div class="art-Post-inner art-article">

<div class="art-PostContent">

<div id="respond">
  
  <h3>Оставить комментарий</h3>

<div class="cancel-comment-reply">
	<small><a rel="nofollow" id="cancel-comment-reply-link" href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/#respond" style="display:none;">Нажмите, чтобы отменить ответ.</a></small>
</div>


<form action="http://mycontroller.ru/wp-comments-post.php" method="post" id="commentform">


<p><input type="text" name="author" id="author" value="" size="22" tabindex="1">
<label for="author"><small>Имя </small></label></p>

<p><input type="text" name="email" id="email" value="" size="22" tabindex="2">
<label for="email"><small>E-mail (не публикуется) </small></label></p>

<p><input type="text" name="url" id="url" value="" size="22" tabindex="3">
<label for="url"><small>Web-сайт</small></label></p>


<!--<p><small><strong>XHTML:</strong> Вы можете использовать эту разметку: <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code lang=&quot;&quot;&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; &lt;pre lang=&quot;&quot; extra=&quot;&quot;&gt; </code></small></p>-->

<p><textarea name="comment" id="comment" cols="100%" rows="10" tabindex="4"></textarea></p>

<p>
	<span class="art-button-wrapper">
		<span class="l"> </span>
		<span class="r"> </span>
		<input class="art-button" type="submit" name="submit" tabindex="5" value="Отправить">
	</span>
<input type="hidden" name="comment_post_ID" value="3226" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p>

</form>

</div>

</div>
<div class="cleared"></div>


</div>

		<div class="cleared"></div>
    </div>
</div>


</div>
<div class="art-sidebar1">      
<div id="mycategoryorder-2" class="widget widget_mycategoryorder"><div class="art-Block">
    <div class="art-Block-body">
<div class="art-BlockHeader">
    <div class="l"></div>
    <div class="r"></div>
    <div class="art-header-tag-icon">
        <div class="t">Рубрики</div>
    </div>
</div><div class="art-BlockContent">
    <div class="art-BlockContent-tl"></div>
    <div class="art-BlockContent-tr"></div>
    <div class="art-BlockContent-bl"></div>
    <div class="art-BlockContent-br"></div>
    <div class="art-BlockContent-tc"></div>
    <div class="art-BlockContent-bc"></div>
    <div class="art-BlockContent-cl"></div>
    <div class="art-BlockContent-cr"></div>
    <div class="art-BlockContent-cc"></div>
    <div class="art-BlockContent-body">
		<ul>
			<li class="cat-item cat-item-3"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/" title="Просмотреть все записи в рубрике «МИКРОКОНТРОЛЛЕРЫ STM32»">МИКРОКОНТРОЛЛЕРЫ STM32</a>
<ul class="children">
	<li class="cat-item cat-item-7"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/bootloader/" title="Просмотреть все записи в рубрике «Bootloader»">Bootloader</a>
</li>
	<li class="cat-item cat-item-14"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/portyi-vvoda-vyivoda/" title="Просмотреть все записи в рубрике «GPIO»">GPIO</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/usart/" title="Просмотреть все записи в рубрике «USART»">USART</a>
</li>
	<li class="cat-item cat-item-5"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/dma/" title="Просмотреть все записи в рубрике «DMA»">DMA</a>
</li>
	<li class="cat-item cat-item-15"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/bkp-registryi/" title="Просмотреть все записи в рубрике «BKP»">BKP</a>
</li>
	<li class="cat-item cat-item-8"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/rtc/" title="Просмотреть все записи в рубрике «RTC»">RTC</a>
</li>
	<li class="cat-item cat-item-16"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/timer/" title="Просмотреть все записи в рубрике «TIMER»">TIMER</a>
</li>
	<li class="cat-item cat-item-21"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/spi/" title="Просмотреть все записи в рубрике «SPI»">SPI</a>
</li>
	<li class="cat-item cat-item-24"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/adc/" title="Просмотреть все записи в рубрике «ADC»">ADC</a>
</li>
	<li class="cat-item cat-item-25"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/dac/" title="Просмотреть все записи в рубрике «DAC»">DAC</a>
</li>
	<li class="cat-item cat-item-26"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/usb/" title="Просмотреть все записи в рубрике «USB»">USB</a>
</li>
</ul>
</li>
	<li class="cat-item cat-item-19"><a href="http://mycontroller.ru/category/vneshnie-ustroystva/" title="Просмотреть все записи в рубрике «ВНЕШНИЕ УСТРОЙСТВА»">ВНЕШНИЕ УСТРОЙСТВА</a>
<ul class="children">
	<li class="cat-item cat-item-23"><a href="http://mycontroller.ru/category/vneshnie-ustroystva/termodatchik-ds18b20/" title="Просмотреть все записи в рубрике «Термодатчик ds18b20»">Термодатчик ds18b20</a>
</li>
	<li class="cat-item cat-item-29"><a href="http://mycontroller.ru/category/vneshnie-ustroystva/enkoder/" title="Просмотреть все записи в рубрике «Энкодер»">Энкодер</a>
</li>
	<li class="cat-item cat-item-20"><a href="http://mycontroller.ru/category/vneshnie-ustroystva/karta-pamyati-sd/" title="Просмотреть все записи в рубрике «Карта памяти SD»">Карта памяти SD</a>
	<ul class="children">
	<li class="cat-item cat-item-31"><a href="http://mycontroller.ru/category/vneshnie-ustroystva/karta-pamyati-sd/rabota-s-ffatfs/" title="Просмотреть все записи в рубрике «Работа с FatFs»">Работа с FatFs</a>
</li>
	</ul>
</li>
</ul>
</li>
	<li class="cat-item cat-item-1"><a href="http://mycontroller.ru/category/bez-rubriki/" title="Просмотреть все записи в рубрике «МОИ ПРОЕКТЫ»">МОИ ПРОЕКТЫ</a>
<ul class="children">
	<li class="cat-item cat-item-6"><a href="http://mycontroller.ru/category/bez-rubriki/chasyi-na-stm32f100rb/" title="Просмотреть все записи в рубрике «Часы на STM32F100RB»">Часы на STM32F100RB</a>
</li>
	<li class="cat-item cat-item-28"><a href="http://mycontroller.ru/category/bez-rubriki/umnyiy-dom/" title="Просмотреть все записи в рубрике «Умный Дом»">Умный Дом</a>
</li>
	<li class="cat-item cat-item-30"><a href="http://mycontroller.ru/category/bez-rubriki/waveplayer/" title="Просмотреть все записи в рубрике «WavePlayer»">WavePlayer</a>
</li>
</ul>
</li>
	<li class="cat-item cat-item-10"><a href="http://mycontroller.ru/category/poleznyiy-soft/" title="Просмотреть все записи в рубрике «ПОЛЕЗНЫЙ СОФТ»">ПОЛЕЗНЫЙ СОФТ</a>
<ul class="children">
	<li class="cat-item cat-item-11"><a href="http://mycontroller.ru/category/poleznyiy-soft/stm32-generator-koda/" title="Просмотреть все записи в рубрике «STM32 генератор»">STM32 генератор</a>
</li>
</ul>
</li>
		</ul>
		
		<div class="cleared"></div>
    </div>
</div>

		<div class="cleared"></div>
    </div>
</div>
</div>		<div id="recent-posts-2" class="widget widget_recent_entries"><div class="art-Block">
    <div class="art-Block-body">
		<div class="art-BlockHeader">
    <div class="l"></div>
    <div class="r"></div>
    <div class="art-header-tag-icon">
        <div class="t">Свежие записи</div>
    </div>
</div><div class="art-BlockContent">
    <div class="art-BlockContent-tl"></div>
    <div class="art-BlockContent-tr"></div>
    <div class="art-BlockContent-bl"></div>
    <div class="art-BlockContent-br"></div>
    <div class="art-BlockContent-tc"></div>
    <div class="art-BlockContent-bc"></div>
    <div class="art-BlockContent-cl"></div>
    <div class="art-BlockContent-cr"></div>
    <div class="art-BlockContent-cc"></div>
    <div class="art-BlockContent-body">
		<ul>
				<li><a href="http://mycontroller.ru/stm32-generator-koda-novaya-versiya/" title="STM32 Генератор кода. Новая версия">STM32 Генератор кода. Новая версия</a></li>
				<li><a href="http://mycontroller.ru/stm32-generator-koda-konstruktor-komponentov/" title="STM32 “Конструктор компонентов” для “Генератора кода”">STM32 “Конструктор компонентов” для “Генератора кода”</a></li>
				<li><a href="./STM32 Воспроизведение звука. Расширение возможностей программы_files/STM32 Воспроизведение звука. Расширение возможностей программы.htm" title="STM32 Воспроизведение звука. Расширение возможностей программы">STM32 Воспроизведение звука. Расширение возможностей программы</a></li>
				<li><a href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-nastroyka-dac/" title="STM32 Воспроизведение звука. Настройка периферии + первый звук">STM32 Воспроизведение звука. Настройка периферии + первый звук</a></li>
				<li><a href="http://mycontroller.ru/stm32-dac-primeryi-ispolzovaniya/" title="STM32 DAC Примеры использования">STM32 DAC Примеры использования</a></li>
				</ul>
		
		<div class="cleared"></div>
    </div>
</div>

		<div class="cleared"></div>
    </div>
</div>
</div><div id="text-5" class="widget widget_text"><div class="art-Block">
    <div class="art-Block-body">
<div class="art-BlockHeader">
    <div class="l"></div>
    <div class="r"></div>
    <div class="art-header-tag-icon">
        <div class="t">Немного рекламы</div>
    </div>
</div><div class="art-BlockContent">
    <div class="art-BlockContent-tl"></div>
    <div class="art-BlockContent-tr"></div>
    <div class="art-BlockContent-bl"></div>
    <div class="art-BlockContent-br"></div>
    <div class="art-BlockContent-tc"></div>
    <div class="art-BlockContent-bc"></div>
    <div class="art-BlockContent-cl"></div>
    <div class="art-BlockContent-cr"></div>
    <div class="art-BlockContent-cc"></div>
    <div class="art-BlockContent-body">
			<div class="textwidget"><script type="text/javascript"><!--
google_ad_client = "ca-pub-6213925206017237";
/* second */
google_ad_slot = "7273021636";
google_ad_width = 200;
google_ad_height = 200;
//-->
</script>
<script type="text/javascript" src="./STM32 Воспроизведение звука. Расширение возможностей программы_files/show_ads.js">
</script><ins style="display:inline-table;border:none;height:200px;margin:0;padding:0;position:relative;visibility:visible;width:200px"><ins id="aswift_0_anchor" style="display:block;border:none;height:200px;margin:0;padding:0;position:relative;visibility:visible;width:200px"><iframe allowtransparency="true" frameborder="0" height="200" hspace="0" marginwidth="0" marginheight="0" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){w.location.replace(h)}}" scrolling="no" vspace="0" width="200" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;"></iframe></ins></ins></div>
		
		<div class="cleared"></div>
    </div>
</div>

		<div class="cleared"></div>
    </div>
</div>
</div>

<p align="center">

</p>

</div>
</div>
<div class="cleared"></div>

<div class="art-Footer">
    <div class="art-Footer-inner">
                <div class="art-Footer-text">
<p>
<a href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/#">Contact Us</a> | <a href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/#">Terms of Use</a> | <a href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/#">Trademarks</a> | <a href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/#">Privacy Statement</a><br>Copyright © 2009 My Controller. All Rights Reserved.</p>
</div>
    </div>
    <div class="art-Footer-background">
    </div>
</div>

		<div class="cleared"></div>
    </div>
</div>
<div class="cleared"></div>
<p class="art-page-footer">Powered by <a href="http://wordpress.org/">WordPress</a> and <a href="http://www.artisteer.com/?p=wordpress_themes">WordPress Theme</a> created with Artisteer.</p>
</div>

<!-- 24 запросов. 0,342 секунд. -->
<div>
<!-- SyntaxHighlighter Stuff -->
<script type="text/javascript" src="./STM32 Воспроизведение звука. Расширение возможностей программы_files/shCore.js"></script>
<script type="text/javascript">
	SyntaxHighlighter.all();
</script>

</div>


</body></html>