<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0084)http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/ -->
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="ru-RU" class="chrome  win"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<title>STM32 SD Card. Инициализация и использование карты памяти</title>
<script type="text/javascript" src="./STM32 SD Card. Инициализация и использование карты памяти_files/script.js"></script>
<link rel="stylesheet" href="./STM32 SD Card. Инициализация и использование карты памяти_files/style.css" type="text/css" media="screen">
<!--[if IE 6]><link rel="stylesheet" href="http://mycontroller.ru/wp-content/themes/MyController/style.ie6.css" type="text/css" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="http://mycontroller.ru/wp-content/themes/MyController/style.ie7.css" type="text/css" media="screen" /><![endif]-->
<link rel="alternate" type="application/rss+xml" title="RSS-лента My Controller" href="http://mycontroller.ru/feed/">
<link rel="alternate" type="application/atom+xml" title="Atom-лента My Controller" href="http://mycontroller.ru/feed/atom/"> 
<link rel="pingback" href="http://mycontroller.ru/xmlrpc.php">
<link rel="alternate" type="application/rss+xml" title="My Controller » Лента комментариев к «STM32 SD Card. Инициализация и использование карты памяти»" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/feed/">
<link rel="stylesheet" id="msw_wpfm_scan-css" href="./STM32 SD Card. Инициализация и использование карты памяти_files/wordpress-file-monitor.php" type="text/css" media="all">
<link rel="stylesheet" id="bwp-syntax-css" href="./STM32 SD Card. Инициализация и использование карты памяти_files/bwp-syntax.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-downloadmanager-css" href="./STM32 SD Card. Инициализация и использование карты памяти_files/download-css.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-pagenavi-css" href="./STM32 SD Card. Инициализация и использование карты памяти_files/pagenavi-css.css" type="text/css" media="all">
<script type="text/javascript" src="./STM32 SD Card. Инициализация и использование карты памяти_files/jquery.js"></script>
<script type="text/javascript" src="./STM32 SD Card. Инициализация и использование карты памяти_files/bwp-syntax.js"></script>
<script type="text/javascript" src="./STM32 SD Card. Инициализация и использование карты памяти_files/external-tracking.min.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://mycontroller.ru/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://mycontroller.ru/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="STM32 Внешние устройства. Введение" href="http://mycontroller.ru/stm32-vneshnie-ustroystva-vvedenie/">
<link rel="next" title="STM32 SPI  Введение" href="http://mycontroller.ru/stm32-spi-vvedenie/">
<meta name="generator" content="WordPress 3.3.1">
<link rel="canonical" href="./STM32 SD Card. Инициализация и использование карты памяти_files/STM32 SD Card. Инициализация и использование карты памяти.htm">
<link rel="shortlink" href="http://mycontroller.ru/?p=1428">

<link rel="stylesheet" href="./STM32 SD Card. Инициализация и использование карты памяти_files/wp-syntax.css" type="text/css" media="screen">
<!-- wpSpoiler Code -->
        <script type="text/javascript">
            function wpSpoilerToggle(spoiler, link, showtext, hidetext) {
                if (spoiler.style.display != 'none') {
                    spoiler.style.display = 'none';
                    link.innerHTML = showtext;
                    link.className = 'spoiler_link_show';
                } else {
                    spoiler.style.display = 'block';
                    link.innerHTML = hidetext;
                    link.className = 'spoiler_link_hide';
                }
            }
          </script>
	<link type="text/css" rel="stylesheet" href="./STM32 SD Card. Инициализация и использование карты памяти_files/shCore.css">
	<link type="text/css" rel="stylesheet" href="./STM32 SD Card. Инициализация и использование карты памяти_files/shThemeDefault.css">
<!-- Google Analytics Tracking by Google Analyticator 6.0.2: http://ronaldheft.com/code/analyticator/ -->
<script type="text/javascript">window.google_analytics_uacct = "UA-29082067-1";</script>
<script type="text/javascript">
	var analyticsFileTypes = [''];
	var analyticsEventTracking = 'enabled';
</script>
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-29082067-1']);
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	})();
</script><script type="text/javascript" async="" src="./STM32 SD Card. Инициализация и использование карты памяти_files/ga.js"></script>
</head>
<body>
<div id="art-page-background-simple-gradient">
</div>
<div id="art-main">
<div class="art-Sheet">
    <div class="art-Sheet-tl"></div>
    <div class="art-Sheet-tr"></div>
    <div class="art-Sheet-bl"></div>
    <div class="art-Sheet-br"></div>
    <div class="art-Sheet-tc"></div>
    <div class="art-Sheet-bc"></div>
    <div class="art-Sheet-cl"></div>
    <div class="art-Sheet-cr"></div>
    <div class="art-Sheet-cc"></div>
    <div class="art-Sheet-body">
<div class="art-Header">
    <div class="art-Header-png"></div>
    <div class="art-Header-jpeg"></div>
<div class="art-Logo">
    <h1 id="name-text" class="art-Logo-name">
        <a href="http://mycontroller.ru/">My Controller</a></h1>
    <div id="slogan-text" class="art-Logo-text">
        Изучаем микроконтроллеры STM32</div>
</div>

</div>
<div class="art-nav">
	<div class="l"></div>
	<div class="r"></div>
	<ul class="art-menu">
		<li><a href="http://mycontroller.ru/"><span class="l"></span><span class="r"></span><span class="t">Home</span></a></li><li><span class="art-menu-separator"></span></li><li class="page_item page-item-10"><a href="http://mycontroller.ru/o-sayte/"><span class="l"></span><span class="r"></span><span class="t">О сайте</span></a></li><li><span class="art-menu-separator"></span></li>
<li class="page_item page-item-186"><a href="http://mycontroller.ru/programmyi/"><span class="l"></span><span class="r"></span><span class="t">СОФТ</span></a></li>
	</ul>
</div>
<div class="art-contentLayout">
<div class="art-content">

<div class="art-Post">
    <div class="art-Post-tl"></div>
    <div class="art-Post-tr"></div>
    <div class="art-Post-bl"></div>
    <div class="art-Post-br"></div>
    <div class="art-Post-tc"></div>
    <div class="art-Post-bc"></div>
    <div class="art-Post-cl"></div>
    <div class="art-Post-cr"></div>
    <div class="art-Post-cc"></div>
    <div class="art-Post-body">
<div class="art-Post-inner art-article">

<div class="art-PostContent">

<div class="navigation">
	<div class="alignleft">« <a href="http://mycontroller.ru/stm32-vneshnie-ustroystva-vvedenie/" rel="prev">STM32 Внешние устройства. Введение</a></div>
	<div class="alignright"><a href="http://mycontroller.ru/stm32-spi-vvedenie/" rel="next">STM32 SPI  Введение</a> »</div>
</div>

</div>
<div class="cleared"></div>


</div>

		<div class="cleared"></div>
    </div>
</div>

<div class="art-Post">
    <div class="art-Post-tl"></div>
    <div class="art-Post-tr"></div>
    <div class="art-Post-bl"></div>
    <div class="art-Post-br"></div>
    <div class="art-Post-tc"></div>
    <div class="art-Post-bc"></div>
    <div class="art-Post-cl"></div>
    <div class="art-Post-cr"></div>
    <div class="art-Post-cc"></div>
    <div class="art-Post-body">
<div class="art-Post-inner art-article">
<h2 class="art-PostHeader">
<a href="./STM32 SD Card. Инициализация и использование карты памяти_files/STM32 SD Card. Инициализация и использование карты памяти.htm" rel="bookmark" title="Постоянная ссылка на STM32 SD Card. Инициализация и использование карты памяти">
STM32 SD Card. Инициализация и использование карты памяти</a>
</h2>
<div class="art-PostContent">

          <p>Общение с SD-картой производится путем посылки специальных команд, которые включают в себя:
</p>
<ul>
<li><font color="#000000">код команды;</font> </li>
<li><font color="#000000">32-х разрядный аргумент;</font> </li>
<li><font color="#000000">код CRC, подтверждающий правильность данных (в режиме SPI этот код нужен только для двух команд)</font> </li>
</ul>
<p>Команд много, но для решения поставленной задачи можно ограничится перечисленными ниже:<br>
<span id="more-1428"></span></p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#define GO_IDLE_STATE            0              //Программная перезагрузка   </span>
<span style="color: #339933;">#define SEND_IF_COND             8              //Для SDC V2 - проверка диапазона напряжений   </span>
<span style="color: #339933;">#define READ_SINGLE_BLOCK        17             //Чтение указанного блока данных  </span>
<span style="color: #339933;">#define WRITE_SINGLE_BLOCK       24             //Запись указанного блока данных</span>
<span style="color: #339933;">#define SD_SEND_OP_COND	         41             //Начало процесса инициализации  </span>
<span style="color: #339933;">#define APP_CMD			 55             //Главная команда из ACMD &lt;n&gt; команд</span>
<span style="color: #339933;">#define READ_OCR		 58             //Чтение регистра OCR</span></pre></td></tr></tbody></table></div>

<p>Командам даны осмысленные имена, которые будем использовать при обращении к функции, посылающей их карте памяти. Текст этой функции приведен ниже:<br>
<a class="spoiler_link_show" href="javascript:void(0)" onclick="wpSpoilerToggle(document.getElementById(&#39;id565353351&#39;), this, &#39;Показать код&#39;, &#39;Скрыть код&#39;)">Показать код</a>
</p><div class="spoiler_div" id="id565353351" style="display:none"><p></p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//глобальная переменная для определения типа карты </span>
<span style="color: #993333;">uint8_t</span>  SDHC<span style="color: #339933;">;</span>            
<span style="color: #666666; font-style: italic;">//макроопределения для управления выводом SS</span>
<span style="color: #339933;">#define CS_ENABLE         GPIOA-&gt;BSRR = GPIO_BSRR_BR4;         </span>
<span style="color: #339933;">#define CS_DISABLE    	  GPIOA-&gt;BSRR = GPIO_BSRR_BS4;  </span>
<span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #666666; font-style: italic;">//function	 посылка команды в SD                                		            //</span>
<span style="color: #666666; font-style: italic;">//Arguments	 команда и ее аргумент                                                      //</span>
<span style="color: #666666; font-style: italic;">//return	 0xff - нет ответа   			                                    //</span>
<span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #993333;">uint8_t</span> SD_sendCommand<span style="color: #009900;">(</span><span style="color: #993333;">uint8_t</span> cmd<span style="color: #339933;">,</span> <span style="color: #993333;">uint32_t</span> arg<span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
  <span style="color: #993333;">uint8_t</span> response<span style="color: #339933;">,</span> wait<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span> tmp<span style="color: #339933;">;</span>     
&nbsp;
  <span style="color: #666666; font-style: italic;">//для карт памяти SD выполнить корекцию адреса, т.к. для них адресация побайтная </span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>SDHC <span style="color: #339933;">==</span> <span style="color: #0000dd;">0</span><span style="color: #009900;">)</span>		
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>cmd <span style="color: #339933;">==</span> READ_SINGLE_BLOCK <span style="color: #339933;">||</span> cmd <span style="color: #339933;">==</span> WRITE_SINGLE_BLOCK <span style="color: #009900;">)</span>  <span style="color: #009900;">{</span>arg <span style="color: #339933;">=</span> arg <span style="color: #339933;">&lt;&lt;</span> <span style="color: #0000dd;">9</span><span style="color: #339933;">;</span><span style="color: #009900;">}</span>
  <span style="color: #666666; font-style: italic;">//для SDHC корекцию адреса блока выполнять не нужно(постраничная адресация)	</span>
&nbsp;
  CS_ENABLE<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//передать код команды и ее аргумент</span>
  spi_send<span style="color: #009900;">(</span>cmd <span style="color: #339933;">|</span> <span style="color: #208080;">0x40</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
  spi_send<span style="color: #009900;">(</span>arg<span style="color: #339933;">&gt;&gt;</span><span style="color: #0000dd;">24</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
  spi_send<span style="color: #009900;">(</span>arg<span style="color: #339933;">&gt;&gt;</span><span style="color: #0000dd;">16</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
  spi_send<span style="color: #009900;">(</span>arg<span style="color: #339933;">&gt;&gt;</span><span style="color: #0000dd;">8</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
  spi_send<span style="color: #009900;">(</span>arg<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//передать CRC (учитываем только для двух команд)</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>cmd <span style="color: #339933;">==</span> SEND_IF_COND<span style="color: #009900;">)</span> spi_send<span style="color: #009900;">(</span><span style="color: #208080;">0x87</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>            
  <span style="color: #b1b100;">else</span>                    spi_send<span style="color: #009900;">(</span><span style="color: #208080;">0x95</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span> 
&nbsp;
  <span style="color: #666666; font-style: italic;">//ожидаем ответ</span>
  <span style="color: #b1b100;">while</span><span style="color: #009900;">(</span><span style="color: #009900;">(</span>response <span style="color: #339933;">=</span> spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #339933;">==</span> <span style="color: #208080;">0xff</span><span style="color: #009900;">)</span> 
   <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>wait<span style="color: #339933;">++</span> <span style="color: #339933;">&gt;</span> <span style="color: #208080;">0xfe</span><span style="color: #009900;">)</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>                <span style="color: #666666; font-style: italic;">//таймаут, не получили ответ на команду</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//проверка ответа если посылалась команда READ_OCR</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>response <span style="color: #339933;">==</span> <span style="color: #208080;">0x00</span> <span style="color: #339933;">&amp;&amp;</span> cmd <span style="color: #339933;">==</span> <span style="color: #0000dd;">58</span><span style="color: #009900;">)</span>     
  <span style="color: #009900;">{</span>
    tmp <span style="color: #339933;">=</span> spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>                      <span style="color: #666666; font-style: italic;">//прочитат один байт регистра OCR            </span>
    <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>tmp <span style="color: #339933;">&amp;</span> <span style="color: #208080;">0x40</span><span style="color: #009900;">)</span> SDHC <span style="color: #339933;">=</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>               <span style="color: #666666; font-style: italic;">//обнаружена карта SDHC </span>
    <span style="color: #b1b100;">else</span>           SDHC <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>               <span style="color: #666666; font-style: italic;">//обнаружена карта SD</span>
    <span style="color: #666666; font-style: italic;">//прочитать три оставшихся байта регистра OCR</span>
    spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span> 
    spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span> 
    spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span> 
  <span style="color: #009900;">}</span>
&nbsp;
  spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
  CS_DISABLE<span style="color: #339933;">;</span> 
&nbsp;
  <span style="color: #b1b100;">return</span> response<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Глобальная переменная SDHC нужна для определения типа карты памяти. Эта переменная будет установленна в единицу, если тип обнаруженной карты – “SDHC” (объем памяти превышает 4 гигабайта). У карт “SDHC” и “SD” разная адресация блоков:</p>
<ul>
<li>SD используют байтную адресацию: для обращения к первому блоку необходимо указать адрес 0х0000, ко второму – 0х0200, к третьему – 0х400 и так далее, т.е. указать на первый байт блока; </li>
<li>SDHC используют блочную адресацию: первый блок имеет адрес 0, второй – 1, третий – 2 , т.е. при адресации указываем номер блока. </li>
</ul>
<p><font color="#0a1c1f">Когда функции SD_sendCommand передается команда, аргументом которой является номер блока данных, это отличие учитывается. Для карт SD производится умножение номера блока на 512 (сдвиг влево на 9 разрядов).</font></p>
<p>&nbsp;</p>
<p></p></div>
<br>
Дальше следуют функции, посредством которых основная программа будет общаться с картой памяти<br>
Функция инициализации <strong> uint8_t SD_init(void)</strong><br>
<a class="spoiler_link_show" href="javascript:void(0)" onclick="wpSpoilerToggle(document.getElementById(&#39;id757210344&#39;), this, &#39;Показать код&#39;, &#39;Скрыть код&#39;)">Показать код</a>
<div class="spoiler_div" id="id757210344" style="display:none"><p></p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #666666; font-style: italic;">//function	 инициализация карты памяти                         			    //</span>
<span style="color: #666666; font-style: italic;">//return	 0 - карта инициализирована  					            //</span>
<span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #993333;">uint8_t</span> SD_init<span style="color: #009900;">(</span><span style="color: #993333;">void</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
  <span style="color: #993333;">uint8_t</span>   i<span style="color: #339933;">;</span>
  <span style="color: #993333;">uint8_t</span>   response<span style="color: #339933;">;</span>
  <span style="color: #993333;">uint8_t</span>   SD_version <span style="color: #339933;">=</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>	          <span style="color: #666666; font-style: italic;">//по умолчанию версия SD = 2</span>
  <span style="color: #993333;">uint16_t</span>  retry <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span> <span style="color: #339933;">;</span>
&nbsp;
  spi_init<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>                            <span style="color: #666666; font-style: italic;">//инициализировать модуль SPI                        </span>
  <span style="color: #b1b100;">for</span><span style="color: #009900;">(</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>i<span style="color: #339933;">&lt;</span><span style="color: #0000dd;">10</span><span style="color: #339933;">;</span>i<span style="color: #339933;">++</span><span style="color: #009900;">)</span> spi_send<span style="color: #009900;">(</span><span style="color: #208080;">0xff</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>      <span style="color: #666666; font-style: italic;">//послать свыше 74 единиц   </span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//выполним программный сброс карты</span>
  CS_ENABLE<span style="color: #339933;">;</span>
  <span style="color: #b1b100;">while</span><span style="color: #009900;">(</span>SD_sendCommand<span style="color: #009900;">(</span>GO_IDLE_STATE<span style="color: #339933;">,</span> <span style="color: #0000dd;">0</span><span style="color: #009900;">)</span><span style="color: #339933;">!=</span><span style="color: #208080;">0x01</span><span style="color: #009900;">)</span>                                   
    <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>retry<span style="color: #339933;">++&gt;</span><span style="color: #208080;">0x20</span><span style="color: #009900;">)</span>  <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>                    
  CS_DISABLE<span style="color: #339933;">;</span>
  spi_send <span style="color: #009900;">(</span><span style="color: #208080;">0xff</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
  spi_send <span style="color: #009900;">(</span><span style="color: #208080;">0xff</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
  retry <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>                                     
  <span style="color: #b1b100;">while</span><span style="color: #009900;">(</span>SD_sendCommand<span style="color: #009900;">(</span>SEND_IF_COND<span style="color: #339933;">,</span><span style="color: #208080;">0x000001AA</span><span style="color: #009900;">)</span><span style="color: #339933;">!=</span><span style="color: #208080;">0x01</span><span style="color: #009900;">)</span>
  <span style="color: #009900;">{</span> 
    <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>retry<span style="color: #339933;">++&gt;</span><span style="color: #208080;">0xfe</span><span style="color: #009900;">)</span> 
    <span style="color: #009900;">{</span> 
      SD_version <span style="color: #339933;">=</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
      <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">}</span> 
  <span style="color: #009900;">}</span>
&nbsp;
 retry <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>                                     
 <span style="color: #b1b100;">do</span>
 <span style="color: #009900;">{</span>
   response <span style="color: #339933;">=</span> SD_sendCommand<span style="color: #009900;">(</span>APP_CMD<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span> 
   response <span style="color: #339933;">=</span> SD_sendCommand<span style="color: #009900;">(</span>SD_SEND_OP_COND<span style="color: #339933;">,</span><span style="color: #208080;">0x40000000</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
   retry<span style="color: #339933;">++;</span>
   <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>retry<span style="color: #339933;">&gt;</span><span style="color: #208080;">0xffe</span><span style="color: #009900;">)</span> <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>                     
 <span style="color: #009900;">}</span><span style="color: #b1b100;">while</span><span style="color: #009900;">(</span>response <span style="color: #339933;">!=</span> <span style="color: #208080;">0x00</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>                      
&nbsp;
&nbsp;
 <span style="color: #666666; font-style: italic;">//читаем регистр OCR, чтобы определить тип карты</span>
 retry <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
 SDHC <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
 <span style="color: #b1b100;">if</span> <span style="color: #009900;">(</span>SD_version <span style="color: #339933;">==</span> <span style="color: #0000dd;">2</span><span style="color: #009900;">)</span>
 <span style="color: #009900;">{</span> 
   <span style="color: #b1b100;">while</span><span style="color: #009900;">(</span>SD_sendCommand<span style="color: #009900;">(</span>READ_OCR<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #009900;">)</span><span style="color: #339933;">!=</span><span style="color: #208080;">0x00</span><span style="color: #009900;">)</span>
	 <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>retry<span style="color: #339933;">++&gt;</span><span style="color: #208080;">0xfe</span><span style="color: #009900;">)</span>  <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
 <span style="color: #009900;">}</span>
&nbsp;
 <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> 
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p></p></div>
<br>
При вызове этой функции выполняется инициализация карты памяти, определяется ее тип (SD или SDHC).<br>
В случае успешной инициализации, возвращается ноль, иначе — единица.<br>
Если карта успешно инициализированна, можно выполнять чтение/запись секторов карты. Для этого предназначены две следующие функции.<p></p>
<p>&nbsp;</p>
<p>Функция чтения выбранного сектора  <strong>uint8_t SD_ReadSector(uint32_t BlockNumb,uint8_t *buff)</strong><br>
<a class="spoiler_link_show" href="javascript:void(0)" onclick="wpSpoilerToggle(document.getElementById(&#39;id167609344&#39;), this, &#39;Показать код&#39;, &#39;Скрыть код&#39;)">Показать код</a>
</p><div class="spoiler_div" id="id167609344" style="display:none"><p></p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #666666; font-style: italic;">//function	 чтение выбранного сектора SD                         			    //</span>
<span style="color: #666666; font-style: italic;">//аrguments	 номер сектора,указатель на буфер размером 512 байт                         //</span>
<span style="color: #666666; font-style: italic;">//return	 0 - сектор прочитан успешно   					            //</span>
<span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #993333;">uint8_t</span> SD_ReadSector<span style="color: #009900;">(</span><span style="color: #993333;">uint32_t</span> BlockNumb<span style="color: #339933;">,</span><span style="color: #993333;">uint8_t</span> <span style="color: #339933;">*</span>buff<span style="color: #009900;">)</span>
<span style="color: #009900;">{</span> 
  <span style="color: #993333;">uint16_t</span> i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//послать команду "чтение одного блока" с указанием его номера</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>SD_sendCommand<span style="color: #009900;">(</span>READ_SINGLE_BLOCK<span style="color: #339933;">,</span> BlockNumb<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>  
  CS_ENABLE<span style="color: #339933;">;</span>
  <span style="color: #666666; font-style: italic;">//ожидание  маркера данных</span>
  <span style="color: #b1b100;">while</span><span style="color: #009900;">(</span>spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #339933;">!=</span> <span style="color: #208080;">0xfe</span><span style="color: #009900;">)</span>                
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>i<span style="color: #339933;">++</span> <span style="color: #339933;">&gt;</span> <span style="color: #208080;">0xfffe</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span>CS_DISABLE<span style="color: #339933;">;</span> <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span><span style="color: #009900;">}</span>       
&nbsp;
  <span style="color: #666666; font-style: italic;">//чтение 512 байт	выбранного сектора</span>
  <span style="color: #b1b100;">for</span><span style="color: #009900;">(</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span><span style="color: #0000dd;">512</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">)</span> <span style="color: #339933;">*</span>buff<span style="color: #339933;">++</span> <span style="color: #339933;">=</span> spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
  spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span> 
  spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span> 
  spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span> 
&nbsp;
  CS_DISABLE<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Параметры этой функции: номер сектора и указатель на массив в памяти, куда будет скопирована страница. В случае успешого копирования, функция возвращает ноль.<br>
</p></div>
<p></p>
<p>&nbsp;</p>
<p>Функция записи выбранного сектора <strong>uint8_t SD_WriteSector(uint32_t BlockNumb,uint8_t *buff)</strong><br>
<a class="spoiler_link_show" href="javascript:void(0)" onclick="wpSpoilerToggle(document.getElementById(&#39;id582568094&#39;), this, &#39;Показать код&#39;, &#39;Скрыть код&#39;)">Показать код</a>
</p><div class="spoiler_div" id="id582568094" style="display:none"><p></p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #666666; font-style: italic;">//function	 запись выбранного сектора SD                         			    //</span>
<span style="color: #666666; font-style: italic;">//аrguments	 номер сектора, указатель на данные для записи                              //</span>
<span style="color: #666666; font-style: italic;">//return	 0 - сектор записан успешно   					            //</span>
<span style="color: #666666; font-style: italic;">//********************************************************************************************</span>
<span style="color: #993333;">uint8_t</span> SD_WriteSector<span style="color: #009900;">(</span><span style="color: #993333;">uint32_t</span> BlockNumb<span style="color: #339933;">,</span><span style="color: #993333;">uint8_t</span> <span style="color: #339933;">*</span>buff<span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
  <span style="color: #993333;">uint8_t</span>     response<span style="color: #339933;">;</span>
  <span style="color: #993333;">uint16_t</span>    i<span style="color: #339933;">,</span>wait<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//послать команду "запись одного блока" с указанием его номера</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span> SD_sendCommand<span style="color: #009900;">(</span>WRITE_SINGLE_BLOCK<span style="color: #339933;">,</span> BlockNumb<span style="color: #009900;">)</span><span style="color: #009900;">)</span> <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
&nbsp;
  CS_ENABLE<span style="color: #339933;">;</span>
  spi_send<span style="color: #009900;">(</span><span style="color: #208080;">0xfe</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>    
&nbsp;
  <span style="color: #666666; font-style: italic;">//записать буфер сектора в карту</span>
  <span style="color: #b1b100;">for</span><span style="color: #009900;">(</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span><span style="color: #0000dd;">512</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">)</span> spi_send<span style="color: #009900;">(</span><span style="color: #339933;">*</span>buff<span style="color: #339933;">++</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
  spi_send<span style="color: #009900;">(</span><span style="color: #208080;">0xff</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>                <span style="color: #666666; font-style: italic;">//читаем 2 байта CRC без его проверки</span>
  spi_send<span style="color: #009900;">(</span><span style="color: #208080;">0xff</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
  response <span style="color: #339933;">=</span> spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span> <span style="color: #009900;">(</span>response <span style="color: #339933;">&amp;</span> <span style="color: #208080;">0x1f</span><span style="color: #009900;">)</span> <span style="color: #339933;">!=</span> <span style="color: #208080;">0x05</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;">//если ошибка при приеме данных картой</span>
  <span style="color: #009900;">{</span> CS_DISABLE<span style="color: #339933;">;</span> <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> <span style="color: #009900;">}</span>
&nbsp;
  <span style="color: #666666; font-style: italic;">//ожидаем окончание записи блока данных</span>
  <span style="color: #b1b100;">while</span><span style="color: #009900;">(</span><span style="color: #339933;">!</span>spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>             <span style="color: #666666; font-style: italic;">//пока карта занята,она выдает ноль</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>wait<span style="color: #339933;">++</span> <span style="color: #339933;">&gt;</span> <span style="color: #208080;">0xfffe</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>CS_DISABLE<span style="color: #339933;">;</span> <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span><span style="color: #009900;">}</span>
&nbsp;
  CS_DISABLE<span style="color: #339933;">;</span>
  spi_send<span style="color: #009900;">(</span><span style="color: #208080;">0xff</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>   
  CS_ENABLE<span style="color: #339933;">;</span>         
&nbsp;
  <span style="color: #b1b100;">while</span><span style="color: #009900;">(</span><span style="color: #339933;">!</span>spi_read<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>               <span style="color: #666666; font-style: italic;">//пока карта занята,она выдает ноль</span>
  <span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>wait<span style="color: #339933;">++</span> <span style="color: #339933;">&gt;</span> <span style="color: #208080;">0xfffe</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>CS_DISABLE<span style="color: #339933;">;</span> <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span><span style="color: #009900;">}</span>
  CS_DISABLE<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td></tr></tbody></table></div>

<p>Аргументы функции — номер сектора и указатель на массив, который нужно записать. В случае успешной записи функция возвращает ноль<br>
</p></div>
<p></p>
<p>&nbsp;</p>
<p>Приведенный ниже пример иллюстрирует порядок использования данных функций.<br>
В нем выполняется копирование данных из сектора №2 в сектор №8:</p>

<div class="wp_syntax"><table><tbody><tr><td class="line_numbers"><pre>1
2
3
4
5
</pre></td><td class="code"><pre class="c" style="font-family:monospace;"><span style="color: #993333;">uint8_t</span> Buff<span style="color: #009900;">[</span><span style="color: #0000dd;">512</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>                  <span style="color: #666666; font-style: italic;">//буфер для чтения/записи сектора карты                  //</span>
&nbsp;
SD_init<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>                          <span style="color: #666666; font-style: italic;">//выполнить инициализацию</span>
SD_ReadSector<span style="color: #009900;">(</span><span style="color: #0000dd;">2</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>Buff<span style="color: #009900;">)</span><span style="color: #339933;">;</span>            <span style="color: #666666; font-style: italic;">//копировать сектор №2 в буфер</span>
SD_WriteSector<span style="color: #009900;">(</span><span style="color: #0000dd;">8</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>Buff<span style="color: #009900;">)</span><span style="color: #339933;">;</span>           <span style="color: #666666; font-style: italic;">//записать даные из буфера в сектор №8</span></pre></td></tr></tbody></table></div>

<p>Как видите, если использовать приведенные выше функции, то работать с картой памяти очень просто. Единственное, что отсутствует в этом примере — это анализ результата, возвращаемого функциями. Если функция вернет единицу, значит нет связи с картой. Это нужно учитывать.<br>
Если требуется увеличить скорость обмена, необходимо при инициализации модуля SPI задать другое значение скорости.<br>
<em>Небольшое примечание. Я работал с картами памяти «Trаnscend» с объемом 2 гигабайта.<br>
Другие тоже должны работать, но я не проверял.</em></p>
                  
</div>
<div class="cleared"></div>
<div class="art-PostFooterIcons art-metadata-icons">
Рубрика: <a href="http://mycontroller.ru/category/vneshnie-ustroystva/karta-pamyati-sd/" title="Просмотреть все записи в рубрике «Карта памяти SD»" rel="category tag">Карта памяти SD</a>
</div>

</div>

		<div class="cleared"></div>
    </div>
</div>


<!-- You can start editing here. -->


<div class="art-Post">
    <div class="art-Post-tl"></div>
    <div class="art-Post-tr"></div>
    <div class="art-Post-bl"></div>
    <div class="art-Post-br"></div>
    <div class="art-Post-tc"></div>
    <div class="art-Post-bc"></div>
    <div class="art-Post-cl"></div>
    <div class="art-Post-cr"></div>
    <div class="art-Post-cc"></div>
    <div class="art-Post-body">
<div class="art-Post-inner art-article">

<div class="art-PostContent">

<h3 id="comments">Комментарии (50) на “STM32 SD Card. Инициализация и использование карты памяти”</h3>



</div>
<div class="cleared"></div>


</div>

		<div class="cleared"></div>
    </div>
</div>


	<ul class="commentlist">
       <li class="comment even thread-even depth-1" id="li-comment-60">
     <div id="comment-60">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-60">17.02.2012 в 13:12</a></div>

      <p>А для чего задана переменная wait в функции чтения сектора, ошибочно?</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=60#respond" onclick="return addComment.moveForm(&quot;comment-60&quot;, &quot;60&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor odd alt depth-2" id="li-comment-61">
     <div id="comment-61">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-61">17.02.2012 в 13:48</a></div>

      <p>Осталась от последней модернизации фукции. Сейчас уберу. Спасибо.</p>
<p>Получилось с SPI2 ?</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=61#respond" onclick="return addComment.moveForm(&quot;comment-61&quot;, &quot;61&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment even depth-2" id="li-comment-62">
     <div id="comment-62">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-62">17.02.2012 в 13:53</a></div>

      <p>К сожалению не получается, щупаю ножку PB14(MISO) осциллографом — она притянута наверх но никаких сигналов не пробегает..  по остальным что то бегает :(</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=62#respond" onclick="return addComment.moveForm(&quot;comment-62&quot;, &quot;62&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor odd alt depth-3" id="li-comment-63">
     <div id="comment-63">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-63">17.02.2012 в 14:00</a></div>

      <p>А если проверить работу модуля как я раньше описал?<br>
<em>Также некоторую проверку модуля можно выполнить, если соединив между собой MISO и MOSI послать байт данных. Если приняли посланный байт, значит порт настроен правильно, модуль работает. Под вопросом останется правильность настройки фазы и полярности тактового сигнала и порядок выдачи данных.</em></p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=63#respond" onclick="return addComment.moveForm(&quot;comment-63&quot;, &quot;63&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
</ul>
</li>
</ul>
</li>
   <li class="comment even thread-odd thread-alt depth-1" id="li-comment-64">
     <div id="comment-64">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-64">17.02.2012 в 14:09</a></div>

      <p>Если я замыкаю эти выводы — процессор вообще не запускается</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=64#respond" onclick="return addComment.moveForm(&quot;comment-64&quot;, &quot;64&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment odd alt thread-even depth-1" id="li-comment-65">
     <div id="comment-65">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-65">17.02.2012 в 14:13</a></div>

      <p>А нет, запустился. Тока вот как правильно послать байт?  Я делаю так:<br>
SD_WriteSector(8, «f»);<br>
SD_ReadSector(8, &amp; *Buff);</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=65#respond" onclick="return addComment.moveForm(&quot;comment-65&quot;, &quot;65&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor even depth-2" id="li-comment-67">
     <div id="comment-67">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-67">17.02.2012 в 14:18</a></div>

      <p>Примерно так:<br>
<code>uint8_tmp;<br>
tmp =  spi_send (0xA5);</code><br>
Отправили 0xA5 и его же должны получить.</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=67#respond" onclick="return addComment.moveForm(&quot;comment-67&quot;, &quot;67&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
</ul>
</li>
   <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-68">
     <div id="comment-68">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-68">17.02.2012 в 14:31</a></div>

      <p>uint8_tmp;<br>
tmp = spi_send (0xA5);<br>
я так понимаю читать не надо?  тогда tmp становится равной 165, т.е. всё верно</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=68#respond" onclick="return addComment.moveForm(&quot;comment-68&quot;, &quot;68&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor even depth-2" id="li-comment-69">
     <div id="comment-69">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-69">17.02.2012 в 14:40</a></div>

      <p>Эта фукция отправляет байт и возвращает принятый. Если содинить MISO и MOSI то что отправим, то и примем.<br>
Так можно проверить работоспособность модуляю</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=69#respond" onclick="return addComment.moveForm(&quot;comment-69&quot;, &quot;69&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
</ul>
</li>
   <li class="comment odd alt thread-even depth-1" id="li-comment-70">
     <div id="comment-70">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-70">17.02.2012 в 14:42</a></div>

      <p>Да, получается модуль работает</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=70#respond" onclick="return addComment.moveForm(&quot;comment-70&quot;, &quot;70&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor even depth-2" id="li-comment-71">
     <div id="comment-71">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-71">17.02.2012 в 14:54</a></div>

      <p>А как проверяете с картой памяти?</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=71#respond" onclick="return addComment.moveForm(&quot;comment-71&quot;, &quot;71&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
</ul>
</li>
   <li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-72">
     <div id="comment-72">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-72">17.02.2012 в 15:07</a></div>

      <p>SD_WriteSector(8, (u8*)0xA5);<br>
SD_ReadSector(8, &amp;*Buff);<br>
sprintf(touch,»%d»,Buff);</p>
<p>Вот таким образом. Неверно?</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=72#respond" onclick="return addComment.moveForm(&quot;comment-72&quot;, &quot;72&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor even depth-2" id="li-comment-73">
     <div id="comment-73">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-73">17.02.2012 в 15:29</a></div>

      <p>А инициализацию карты выполняете?</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=73#respond" onclick="return addComment.moveForm(&quot;comment-73&quot;, &quot;73&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
</ul>
</li>
   <li class="comment odd alt thread-even depth-1" id="li-comment-74">
     <div id="comment-74">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-74">17.02.2012 в 15:37</a></div>

      <p>Да, конечно. Но какой бы сектор полностью забитой карты я бы не пытался прочитать — всегда получаю 9 неизменных цифр 536871028</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=74#respond" onclick="return addComment.moveForm(&quot;comment-74&quot;, &quot;74&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor even depth-2" id="li-comment-75">
     <div id="comment-75">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-75">17.02.2012 в 16:00</a></div>

      <p>А зачем SD_WriteSector(8, (u8*)0xA5) ?</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=75#respond" onclick="return addComment.moveForm(&quot;comment-75&quot;, &quot;75&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment odd alt depth-3" id="li-comment-76">
     <div id="comment-76">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-76">17.02.2012 в 18:28</a></div>

      <p>Иначе компилятор ругается что значение int не подходит туда где должно быть uinit8_t, таким образом просто преобразую значение в нужный формат.</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=76#respond" onclick="return addComment.moveForm(&quot;comment-76&quot;, &quot;76&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor even depth-4" id="li-comment-77">
     <div id="comment-77">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-77">17.02.2012 в 19:58</a></div>

      <p>А можете привести код как вы читаете сектор</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=77#respond" onclick="return addComment.moveForm(&quot;comment-77&quot;, &quot;77&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment odd alt depth-5" id="li-comment-78">
     <div id="comment-78">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-78">18.02.2012 в 08:02</a></div>

      <p>SD_ReadSector(8, &amp;*Buff);</p>

      <div class="reply">
               </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
   <li class="comment byuser comment-author-admin bypostauthor even thread-odd thread-alt depth-1" id="li-comment-79">
     <div id="comment-79">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-79">18.02.2012 в 08:23</a></div>

      <p>Попробуйте так:<br>
<code><br>
uint8_t Buff[512];<br>
SD_init();<br>
SD_ReadSector(2, &amp;Buff); //прочитать второй сектор </code></p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=79#respond" onclick="return addComment.moveForm(&quot;comment-79&quot;, &quot;79&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment odd alt depth-2" id="li-comment-80">
     <div id="comment-80">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-80">18.02.2012 в 09:12</a></div>

      <p>К сожалению снова 9 неизменных цифр при чтении любого сектора (((</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=80#respond" onclick="return addComment.moveForm(&quot;comment-80&quot;, &quot;80&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment even depth-3" id="li-comment-81">
     <div id="comment-81">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-81">18.02.2012 в 09:20</a></div>

      <p>Даже если вынуть карту</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=81#respond" onclick="return addComment.moveForm(&quot;comment-81&quot;, &quot;81&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
</ul>
</li>
   <li class="comment odd alt depth-2" id="li-comment-87">
     <div id="comment-87">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Владимир Стрельников:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-87">20.02.2012 в 19:36</a></div>

      <p>&amp;Buff[0]<br>
&amp;*Buff<br>
как у вас объявлен буфер, просто char Buff[size] ?<br>
тогда всё верно. вы даете неправильный адрес, и данные льются совершенно не туда.<br>
у вас если буфер организован в виде 2хмерного массива [N_Sect][size] — то ваша конструкция имела бы смысл.<br>
зы. неужели такие сложности с указателями. возьмите простейшие методички вузов по Си. и не надо сильно с указателями мудрить, от излишней мудрости с указателями у виндов регулярно синие экраны смерти. поверьте моему 18 летнему опыту творческой писанины только на С…</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=87#respond" onclick="return addComment.moveForm(&quot;comment-87&quot;, &quot;87&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment even depth-3" id="li-comment-88">
     <div id="comment-88">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Владимир Стрельников:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-88">20.02.2012 в 19:39</a></div>

      <p>2Автора:<br>
в случае как вверху<br>
uint8_t SD_WriteSector(uint32_t BlockNumb,uint8_t *buff)<br>
неправильно написано:<br>
uint8_t Buff[512];                  //буфер для чтения/записи сектора карты                  //</p>
<p>SD_init();                          //выполнить инициализацию<br>
SD_ReadSector(2, &amp;Buff);            //копировать сектор №2 в буфер<br>
SD_WriteSector(8, &amp;Buff);<br>
правильно:<br>
SD_ReadSector(2, Buff);            //копировать сектор №2 в буфер<br>
SD_WriteSector(8, Buff);<br>
ибо имя переменной одномерного массива есть адрес этого массива.</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=88#respond" onclick="return addComment.moveForm(&quot;comment-88&quot;, &quot;88&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor odd alt depth-4" id="li-comment-89">
     <div id="comment-89">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-89">20.02.2012 в 21:52</a></div>

      <p><em>«ибо имя переменной одномерного массива есть адрес этого массива»</em><br>
- спасибо за замечание</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=89#respond" onclick="return addComment.moveForm(&quot;comment-89&quot;, &quot;89&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment even depth-4" id="li-comment-103">
     <div id="comment-103">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-103">22.02.2012 в 10:43</a></div>

      <p>Да все равно не работает у меня :)</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=103#respond" onclick="return addComment.moveForm(&quot;comment-103&quot;, &quot;103&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor odd alt depth-5" id="li-comment-104">
     <div id="comment-104">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-104">22.02.2012 в 10:50</a></div>

      <p>А инициализация карты нормально проходит?<br>
Что возвращает функция выполняющая инициализацию?</p>

      <div class="reply">
               </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
   <li class="comment even thread-even depth-1" id="li-comment-106">
     <div id="comment-106">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-106">24.02.2012 в 08:54</a></div>

      <p>Функция возвращает 1</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=106#respond" onclick="return addComment.moveForm(&quot;comment-106&quot;, &quot;106&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor odd alt depth-2" id="li-comment-107">
     <div id="comment-107">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-107">24.02.2012 в 09:56</a></div>

      <p>Значит контроллер не видит карту.<br>
Может быть ошибка подключения?<br>
А какая карта?</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=107#respond" onclick="return addComment.moveForm(&quot;comment-107&quot;, &quot;107&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
</ul>
</li>
   <li class="comment even thread-odd thread-alt depth-1" id="li-comment-108">
     <div id="comment-108">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Sky:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-108">24.02.2012 в 10:24</a></div>

      <p>Ошибки подключения нет, перепроверил несколько раз, карта сама проста микроСД на 2 гБ, в других устройствах работает.</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=108#respond" onclick="return addComment.moveForm(&quot;comment-108&quot;, &quot;108&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment odd alt thread-even depth-1" id="li-comment-214">
     <div id="comment-214">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Xand:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-214">05.04.2012 в 12:28</a></div>

      <p>Я, кажется, понял, что у Sky не так. К предыдущей статье я оставлял коммент, что на SD возможно перепутаны обозначения MOSI и MISO. Контакт 2 SD-карты (DI, data input) нужно подключать к порту PA7(SPI1_MOSI), а контакт 7 (DO, data output) — к PA6(SPI1_MISO). Если включено наоборот — SD_init() вернет 1.</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=214#respond" onclick="return addComment.moveForm(&quot;comment-214&quot;, &quot;214&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment even thread-odd thread-alt depth-1" id="li-comment-450">
     <div id="comment-450">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Somebody:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-450">30.05.2012 в 17:04</a></div>

      <p>Замечательная статья. Все с подробнейшими комментариями и без лишней ерунды. И всё работает. Вопрос один. Будет ли продолжение? Типа поддержки FatFS. :)</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=450#respond" onclick="return addComment.moveForm(&quot;comment-450&quot;, &quot;450&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor odd alt depth-2" id="li-comment-455">
     <div id="comment-455">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-455">31.05.2012 в 14:51</a></div>

      <p>Будет рассмотрена работа с файловой системой. Сейчас потихоньку ковыряю воспроизведение WAVE-файлов для системы «Умный Дом». Когда доведе до ума, тогда выложу описание.</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=455#respond" onclick="return addComment.moveForm(&quot;comment-455&quot;, &quot;455&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment even depth-3" id="li-comment-456">
     <div id="comment-456">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Somebody:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-456">31.05.2012 в 16:33</a></div>

      <p>Спасибо. Буду ждать, если сам не разберусь:)</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=456#respond" onclick="return addComment.moveForm(&quot;comment-456&quot;, &quot;456&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
</ul>
</li>
</ul>
</li>
   <li class="comment odd alt thread-even depth-1" id="li-comment-690">
     <div id="comment-690">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Антон:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-690">29.06.2012 в 19:05</a></div>

      <p>Приветствую всех обитателей сайта и в особенности автора, за его помощь… До этого все ваши примеры работали, а здесь почему то не работают карточки V2.0…. Схожу с ума уже неделю, работаю на stm32discovery чип stm32f100rb… micro_sd 128 и 256mb рабоотают отлично, 2gb и 4gb нет, при чем инициализация проходит все ответы адекватные при попытке вычитать нулевой или первый или другой сектор вычитывает все нули!!! карточки рабочие! на библиотеки чана на аврке работают, когда прикрутил библиотеу чана на stm32 такая же петрушка, sd v1.x работают v 2.0 нет… с вашими функциями все так же. какая то странная загадка связанная с stm32 или IAR. простите за таинственные загадки но не у кого нет идей!!!??? мои закончились :(</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=690#respond" onclick="return addComment.moveForm(&quot;comment-690&quot;, &quot;690&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment even thread-odd thread-alt depth-1" id="li-comment-774">
     <div id="comment-774">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Leo:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-774">25.07.2012 в 11:52</a></div>

      <p>Зачем так мучатся у ST прекрасные библиотеки есть на всю периферию, а контролеры STM32 имеют SDIO Для общения с картами по «родному» интерфейсу.</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=774#respond" onclick="return addComment.moveForm(&quot;comment-774&quot;, &quot;774&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment odd alt thread-even depth-1" id="li-comment-815">
     <div id="comment-815">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">dosikus:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-815">06.08.2012 в 08:13</a></div>

      <p>kontroller:  Будет не лишним при инициализации снижать скорость SPI .<br>
 И если карточка увиделась, повышать скорость.</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=815#respond" onclick="return addComment.moveForm(&quot;comment-815&quot;, &quot;815&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment even thread-odd thread-alt depth-1" id="li-comment-1247">
     <div id="comment-1247">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn"><a href="http://www.amursu.ru/" rel="external nofollow" class="url">goryn21</a>:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1247">25.09.2012 в 08:21</a></div>

      <p>Прочитал статью, всё прекрасно работает,<br>
но добавить работу по DMA не получается.</p>
<p>Использую STM32 105 CL,<br>
SPI2  DMA1_Channel4 и DMA1_Channel5<br>
Буду крайне благодарен за помощь. </p>
<p>Удалось заставить отправлять биты на запись ( см. ф-цию SD_WriteSector ).<br>
На чтение молчит. </p>
<p>Конфигурация SPI:</p>
<p>	SPI2-&gt;CR2	= 0×0007; // Bit 0 RXDMAEN, Bit 1 TXDMAEN, 	Bit 2 SSOE: SS output enable.<br>
	SPI2-&gt;CR1 =	0x037C;            //fPCLK/самый медленный<br>
	//SPI2-&gt;CR1 =	0×0364;                //fPCLK/32<br>
	//SPI2-&gt;CR1 =	0x036C;                //fPCLK/64</p>
<p>Конфигурация DMA:</p>
<p>void DMA_SPI_RX_init(unsigned int perif_addr, unsigned int mem_addr, unsigned int cnt_transfer)  // канал совпадает с TX — USART1<br>
{<br>
 if ((RCC-&gt;AHBENR &amp; RCC_AHBENR_DMA1EN) != RCC_AHBENR_DMA1EN)	 // Если тактов нет<br>
		RCC-&gt;AHBENR |=RCC_AHBENR_DMA1EN;   // подаю такты на DMA1</p>
<p>   for(volatile int i=0; iCPAR = perif_addr; // адрес периферии<br>
	    DMA1_Channel4-&gt;CMAR = mem_addr;   // адрес памяти</p>
<p>	    DMA1_Channel4-&gt;CNDTR = cnt_transfer;       // количество передач данных, при циклической передаче счетчик после достижения 0 будет обновляться</p>
<p>			//DMA1_Channel1-&gt;CCR =0;</p>
<p>			DMA1_Channel4-&gt;CCR = 0<br>
				| (1 * DMA_CCR1_EN		)    // Channel enable	   // включаем канал DMA<br>
				| (0 * DMA_CCR1_TCIE	)    // Transfer complete interrupt enable<br>
				| (0 * DMA_CCR1_HTIE	)    // Half Transfer interrupt enable<br>
				| (0 * DMA_CCR1_TEIE	)    // Transfer error interrupt enable<br>
				| (0 * DMA_CCR1_DIR		)    // Data transfer direction: Peripheral-&gt;Memory   // Из переферии в память<br>
				| (0 * DMA_CCR1_CIRC  )    // Circular mode 	// циклическая передача<br>
				| (0 * DMA_CCR1_PINC  )    // Peripheral increment mode<br>
				| (1 * DMA_CCR1_MINC  )    // Memory increment mode	  //инкремент указателя памяти.<br>
				| (0 * DMA_CCR1_PSIZE_1	)  //10 — 32Bit  //01: 16-bits переферия; DMA_CCR1_PSIZE_0=0×0100  // 0×0 — 8 bit<br>
				| (0 * DMA_CCR1_MSIZE_1 )  //10 — 32Bit  //01: 16-bits; // 0×0 — 8 bit<br>
				| (0 * DMA_CCR1_PL	    )  // Channel Priority level: lowest, conversion frequency is low enough<br>
				| (0 * DMA_CCR1_MEM2MEM )  // Memory to memory mode disabled<br>
				;<br>
}</p>
<p>void DMA_SPI_TX_init(unsigned int perif_addr, unsigned int mem_addr, unsigned int cnt_transfer)  // канал совпадает с RX — USART1<br>
{<br>
 if ((RCC-&gt;AHBENR &amp; RCC_AHBENR_DMA1EN) != RCC_AHBENR_DMA1EN)	 // Если тактов нет<br>
		RCC-&gt;AHBENR |=RCC_AHBENR_DMA1EN;   // подаю такты на DMA1</p>
<p>   for(volatile int i=0; iCPAR = perif_addr; // адрес периферии<br>
	    DMA1_Channel5-&gt;CMAR = mem_addr;   // адрес памяти</p>
<p>	    DMA1_Channel5-&gt;CNDTR = cnt_transfer;       // количество передач данных, при циклической передаче счетчик после достижения 0 будет обновляться</p>
<p>			DMA1_Channel5-&gt;CCR = 0<br>
				| (1 * DMA_CCR1_EN		)    // Channel enable	   // включаем канал DMA<br>
				| (0 * DMA_CCR1_TCIE	)    // Transfer complete interrupt enable<br>
				| (0 * DMA_CCR1_HTIE	)    // Half Transfer interrupt enable<br>
				| (0 * DMA_CCR1_TEIE	)    // Transfer error interrupt enable<br>
				| (1 * DMA_CCR1_DIR		)    // Data transfer direction: Peripheral 0xfffe) {CS_DISABLE; return 1;}       </p>
<p>LED_Status2_ON(); // Для иснхронизации осциллографа (ждущий режим)<br>
  //чтение 512 байт	выбранного сектора<br>
	//for(i=0; iDR), (unsigned int) &amp;buff[0], 512);</p>
<p>	//for(int i=0; iSR &amp;= ~0×01; 			// Молчит как партизан, пробовал и нулём и единицей задавать.</p>
<p>												/*In reception, a DMA request is issued each time RXNE is set to 1. The DMA then reads<br>
											the SPI_DR register (this clears the RXNE flag). */<br>
													/*Bit 0 RXNE: Receive buffer not empty<br>
														0: Rx buffer empty<br>
														1: Rx buffer not empty*/</p>
<p>Delay2_TIM1(500, TIM1_MILLI_SEC_DIV);  //!!! Ахтунг!!! работа с ДМА предполагает другую логику (без блокировки).</p>
<p>LED_Status2_OFF(); // Для иснхронизации осциллографа (ждущий режим)</p>
<p>//    spi_read();<br>
//    spi_read();<br>
//    spi_read(); </p>
<p>CS_DISABLE;</p>
<p>  return 0;<br>
}</p>
<p>//********************************************************************************************<br>
//function	 запись выбранного сектора SD                         			    //<br>
//аrguments	 номер сектора, указатель на данные для записи                              //<br>
//return	 0 — сектор записан успешно   					            //<br>
//********************************************************************************************<br>
uint8_t SD_WriteSector(uint32_t BlockNumb,uint8_t *buff)<br>
{<br>
  uint8_t     response;<br>
  uint16_t    i,wait=0;</p>
<p>  //послать команду «запись одного блока» с указанием его номера<br>
  if( SD_sendCommand(WRITE_SINGLE_BLOCK, BlockNumb)) return 1;</p>
<p>  CS_ENABLE;<br>
  spi_send(0xfe);    </p>
<p>//записать буфер сектора в карту<br>
	LED_Status1_ON(); // Для иснхронизации осциллографа (ждущий режим)<br>
	//	for(i=0; iDR), (unsigned int) &amp;buff[0], 512);</p>
<p>		SPI2-&gt;SR |= 0×02;  /* In transmission, a DMA request is issued each time TXE is set to 1. The DMA then<br>
											 writes to the SPI_DR register (this clears the TXE flag).*/</p>
<p>		while(  ( (SPI2-&gt;SR) &amp; 0×80) &gt; 0) ;		// Проверка BSY<br>
																			/* The software must first wait until TXE=1 and<br>
																				 then until BSY=0.*/</p>
<p>  //!!! Ахтунг!!! работа с ДМА предполагает другую логику (без блокировки).</p>
<p> LED_Status1_OFF();	</p>
<p>// Дальше не понятные мне действия…<br>
//   spi_send(0xff);                //читаем 2 байта CRC без его проверки<br>
//   spi_send(0xff);<br>
//<br>
//   response = spi_read();<br>
//<br>
//   if( (response &amp; 0x1f) != 0×05) //если ошибка при приеме данных картой<br>
//   { CS_DISABLE; return 1; }<br>
//<br>
// 	//ожидаем окончание записи блока данных<br>
// 	while(!spi_read())             //пока карта занята,она выдает ноль<br>
// 	if(wait++ &gt; 0xfffe){CS_DISABLE; return 1;}<br>
//<br>
//   CS_DISABLE;<br>
//   spi_send(0xff);<br>
//   CS_ENABLE;<br>
//<br>
//   while(!spi_read())               //пока карта занята,она выдает ноль<br>
//   if(wait++ &gt; 0xfffe){CS_DISABLE; return 1;}<br>
//   CS_DISABLE;</p>
<p>  return 0;<br>
}</p>
<p>По выходу из SD_ReadSector значение SPI2-&gt;SR = 0×02.</p>
<p>Спасибо!</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=1247#respond" onclick="return addComment.moveForm(&quot;comment-1247&quot;, &quot;1247&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment odd alt thread-even depth-1" id="li-comment-1250">
     <div id="comment-1250">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn"><a href="http://www.amursu.ru/" rel="external nofollow" class="url">goryn21</a>:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1250">25.09.2012 в 12:42</a></div>

      <p>Функции DMA_SPI_TX_init() и SD_ReadSector() друг на друга наехали при отправке сообщения, продублирую их ещё раз. </p>
<p>void DMA_SPI_TX_init(unsigned int perif_addr, unsigned int mem_addr, unsigned int cnt_transfer)  // канал совпадает с RX — USART1<br>
{<br>
 if ((RCC-&gt;AHBENR &amp; RCC_AHBENR_DMA1EN) != RCC_AHBENR_DMA1EN)	 // Если тактов нет<br>
		RCC-&gt;AHBENR |=RCC_AHBENR_DMA1EN;   // подаю такты на DMA1</p>
<p>   for(volatile int i=0; iCPAR = perif_addr; // адрес периферии<br>
	    DMA1_Channel5-&gt;CMAR = mem_addr;   // адрес памяти</p>
<p>	    DMA1_Channel5-&gt;CNDTR = cnt_transfer;       // количество передач данных, при циклической передаче счетчик после достижения 0 будет обновляться</p>
<p>			DMA1_Channel5-&gt;CCR = 0<br>
				| (1 * DMA_CCR1_EN		)    // Channel enable	   // включаем канал DMA<br>
				| (0 * DMA_CCR1_TCIE	)    // Transfer complete interrupt enable<br>
				| (0 * DMA_CCR1_HTIE	)    // Half Transfer interrupt enable<br>
				| (0 * DMA_CCR1_TEIE	)    // Transfer error interrupt enable<br>
				| (1 * DMA_CCR1_DIR		)    // Data transfer direction: Peripheral 0xfffe) {CS_DISABLE; return 1;}       </p>
<p>LED_Status2_ON(); // Для иснхронизации осциллографа (ждущий режим)<br>
  //чтение 512 байт	выбранного сектора<br>
	//for(i=0; iDR), (unsigned int) &amp;buff[0], 512);</p>
<p>	//for(int i=0; iSR &amp;= ~0×01; 			// Молчит как партизан, пробовал и нулём и единицей задавать.<br>
												/*In reception, a DMA request is issued each time RXNE is set to 1. The DMA then reads<br>
											the SPI_DR register (this clears the RXNE flag). */<br>
											/*Bit 0 RXNE: Receive buffer not empty<br>
											0: Rx buffer empty<br>
											1: Rx buffer not empty*/</p>
<p>Delay2_TIM1(500, TIM1_MILLI_SEC_DIV);  //!!! Ахтунг!!! работа с ДМА предполагает другую логику (без блокировки).</p>
<p>LED_Status2_OFF(); // Для иснхронизации осциллографа (ждущий режим)</p>
<p>//    spi_read();<br>
//    spi_read();<br>
//    spi_read(); </p>
<p>CS_DISABLE;</p>
<p>  return 0;<br>
}</p>
<p>Спасибо!</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=1250#respond" onclick="return addComment.moveForm(&quot;comment-1250&quot;, &quot;1250&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment even thread-odd thread-alt depth-1" id="li-comment-1383">
     <div id="comment-1383">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn"><a href="http://how2.org.ua/" rel="external nofollow" class="url">lamazavr</a>:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1383">03.10.2012 в 19:39</a></div>

      <p>Код стопорится на месте<br>
  //ожидаем ответ<br>
  while((response = spi_read()) == 0xff)<br>
   if(wait++ &gt; 0xfe) break;                //таймаут, не получили ответ на команду</p>
<p>В чём может быть трабла?<br>
Код ваш, только spi инициализировал сам:<br>
void spi_init() {<br>
    RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA,ENABLE);  // тактирование порта<br>
    RCC_APB2PeriphClockCmd(RCC_APB2Periph_SPI1,ENABLE);  // тактирование SPI1<br>
    GPIO_InitTypeDef gpio;<br>
    GPIO_StructInit(&amp;gpio);<br>
    gpio.GPIO_Pin = GPIO_Pin_5 | GPIO_Pin_6 | GPIO_Pin_7;<br>
    gpio.GPIO_Mode = GPIO_Mode_AF;<br>
    gpio.GPIO_Speed = GPIO_Speed_50MHz;<br>
    gpio.GPIO_OType = GPIO_OType_PP;<br>
    gpio.GPIO_PuPd = GPIO_PuPd_DOWN;<br>
    GPIO_Init(GPIOA,&amp;gpio);<br>
    GPIO_PinAFConfig(GPIOA,GPIO_PinSource5,GPIO_AF_SPI1);<br>
    GPIO_PinAFConfig(GPIOA,GPIO_PinSource6,GPIO_AF_SPI1);<br>
    GPIO_PinAFConfig(GPIOA,GPIO_PinSource7,GPIO_AF_SPI1);<br>
    SPI_I2S_DeInit(SPI1);<br>
    SPI_InitTypeDef spi1;<br>
    SPI_StructInit(&amp;spi1);<br>
    spi1.SPI_Mode = SPI_Mode_Master;<br>
    spi1.SPI_DataSize = SPI_DataSize_16b;<br>
    spi1.SPI_NSS = SPI_NSS_Soft;<br>
    SPI_CalculateCRC(SPI1,ENABLE);<br>
    SPI_Init(SPI1,&amp;spi1);<br>
    SPI_Cmd(SPI1,ENABLE);<br>
}</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=1383#respond" onclick="return addComment.moveForm(&quot;comment-1383&quot;, &quot;1383&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment odd alt thread-even depth-1" id="li-comment-1411">
     <div id="comment-1411">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Apparatchik:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1411">06.10.2012 в 22:23</a></div>

      <p>Карта инициализацию проходит, а при чтении сектора возвращается еденица. Куда копать?</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=1411#respond" onclick="return addComment.moveForm(&quot;comment-1411&quot;, &quot;1411&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor even depth-2" id="li-comment-1414">
     <div id="comment-1414">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1414">07.10.2012 в 08:29</a></div>

      <p>Карта какая?</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=1414#respond" onclick="return addComment.moveForm(&quot;comment-1414&quot;, &quot;1414&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment odd alt depth-3" id="li-comment-1415">
     <div id="comment-1415">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Apparatchik:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1415">07.10.2012 в 09:50</a></div>

      <p>Micro SD через переходник. К переходнику я подпаялся.</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=1415#respond" onclick="return addComment.moveForm(&quot;comment-1415&quot;, &quot;1415&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment byuser comment-author-admin bypostauthor even depth-4" id="li-comment-1417">
     <div id="comment-1417">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1417">07.10.2012 в 11:15</a></div>

      <p>Объем какой?</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=1417#respond" onclick="return addComment.moveForm(&quot;comment-1417&quot;, &quot;1417&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
<ul class="children">
   <li class="comment odd alt depth-5" id="li-comment-1418">
     <div id="comment-1418">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Apparatchik:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1418">07.10.2012 в 11:19</a></div>

      <p>128MB</p>

      <div class="reply">
               </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment byuser comment-author-admin bypostauthor even depth-5" id="li-comment-1425">
     <div id="comment-1425">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">kontroller:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1425">07.10.2012 в 18:29</a></div>

      <p>Я проверял с 2ГБ, работает.<br>
Посмотрите в моих статьях по работе с FatFs.<br>
Там можно скачать 100% рабочий пример для большинства карт (файлы для работы с FatFs)<br>
Если возникнут вопросы по адаптации, постараюсь помочь</p>

      <div class="reply">
               </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment odd alt depth-5" id="li-comment-1419">
     <div id="comment-1419">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Apparatchik:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1419">07.10.2012 в 11:48</a></div>

      <p>Вот отсюда вылетает:</p>
<p>//послать команду «чтение одного блока» с указанием его номера<br>
if(SD_sendCommand(READ_SINGLE_BLOCK, BlockNumb)) return 1;</p>

      <div class="reply">
               </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment even depth-5" id="li-comment-1421">
     <div id="comment-1421">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Apparatchik:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1421">07.10.2012 в 12:42</a></div>

      <p>SD_sendCommand(READ_SINGLE_BLOCK, BlockNumb) возвращает 0xF8</p>

      <div class="reply">
               </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment odd alt depth-5" id="li-comment-1422">
     <div id="comment-1422">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Apparatchik:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1422">07.10.2012 в 15:03</a></div>

      <p>Попробовал также другие на 1 и 4 гигабайта, результат тотже.</p>

      <div class="reply">
               </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
   <li class="comment even thread-odd thread-alt depth-1" id="li-comment-1574">
     <div id="comment-1574">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Apparatchik:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-1574">19.10.2012 в 18:06</a></div>

      <p>//ожидаем ответ<br>
  while((response = spi_read()) == 0xff)<br>
   if(wait++ &gt; 0xfe) break;                //таймаут, не получили ответ на команду</p>
<p>При успешном выполнении команды ответ R1 должен быть 0×00. Почему мы ждем 0xff растолкуйте пожалуйста?</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=1574#respond" onclick="return addComment.moveForm(&quot;comment-1574&quot;, &quot;1574&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
   <li class="comment odd alt thread-even depth-1" id="li-comment-2252">
     <div id="comment-2252">
<div class="art-Post">
         <div class="art-Post-tl"></div>
         <div class="art-Post-tr"></div>
         <div class="art-Post-bl"></div>
         <div class="art-Post-br"></div>
         <div class="art-Post-tc"></div>
         <div class="art-Post-bc"></div>
         <div class="art-Post-cl"></div>
         <div class="art-Post-cr"></div>
         <div class="art-Post-cc"></div>
         <div class="art-Post-body">
     <div class="art-Post-inner art-article">
     
<div class="art-PostContent">
     
      <div class="comment-author vcard">
                  <cite class="fn">Михаил:</cite>
      </div>
      
      <div class="comment-meta commentmetadata"><a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#comment-2252">22.11.2012 в 08:27</a></div>

      <p>Объясните пожалуйста, для чего нужно<br>
CS_ENABLE;<br>
CS_DISABLE;<br>
Для чего постоянно управлять выводом SS? Почему не достаточно один раз настроить?</p>

      <div class="reply">
         <a class="comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/?replytocom=2252#respond" onclick="return addComment.moveForm(&quot;comment-2252&quot;, &quot;2252&quot;, &quot;respond&quot;, &quot;1428&quot;)">Ответить</a>      </div>

      </div>
      <div class="cleared"></div>
      

      </div>
      
      		<div class="cleared"></div>
          </div>
      </div>
      
     </div>
</li>
  </ul>


 

<div class="art-Post">
    <div class="art-Post-tl"></div>
    <div class="art-Post-tr"></div>
    <div class="art-Post-bl"></div>
    <div class="art-Post-br"></div>
    <div class="art-Post-tc"></div>
    <div class="art-Post-bc"></div>
    <div class="art-Post-cl"></div>
    <div class="art-Post-cr"></div>
    <div class="art-Post-cc"></div>
    <div class="art-Post-body">
<div class="art-Post-inner art-article">

<div class="art-PostContent">

<div id="respond">
  
  <h3>Оставить комментарий</h3>

<div class="cancel-comment-reply">
	<small><a rel="nofollow" id="cancel-comment-reply-link" href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#respond" style="display:none;">Нажмите, чтобы отменить ответ.</a></small>
</div>


<form action="http://mycontroller.ru/wp-comments-post.php" method="post" id="commentform">


<p><input type="text" name="author" id="author" value="" size="22" tabindex="1">
<label for="author"><small>Имя </small></label></p>

<p><input type="text" name="email" id="email" value="" size="22" tabindex="2">
<label for="email"><small>E-mail (не публикуется) </small></label></p>

<p><input type="text" name="url" id="url" value="" size="22" tabindex="3">
<label for="url"><small>Web-сайт</small></label></p>


<!--<p><small><strong>XHTML:</strong> Вы можете использовать эту разметку: <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code lang=&quot;&quot;&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; &lt;pre lang=&quot;&quot; extra=&quot;&quot;&gt; </code></small></p>-->

<p><textarea name="comment" id="comment" cols="100%" rows="10" tabindex="4"></textarea></p>

<p>
	<span class="art-button-wrapper">
		<span class="l"> </span>
		<span class="r"> </span>
		<input class="art-button" type="submit" name="submit" tabindex="5" value="Отправить">
	</span>
<input type="hidden" name="comment_post_ID" value="1428" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p>

</form>

</div>

</div>
<div class="cleared"></div>


</div>

		<div class="cleared"></div>
    </div>
</div>


</div>
<div class="art-sidebar1">      
<div id="mycategoryorder-2" class="widget widget_mycategoryorder"><div class="art-Block">
    <div class="art-Block-body">
<div class="art-BlockHeader">
    <div class="l"></div>
    <div class="r"></div>
    <div class="art-header-tag-icon">
        <div class="t">Рубрики</div>
    </div>
</div><div class="art-BlockContent">
    <div class="art-BlockContent-tl"></div>
    <div class="art-BlockContent-tr"></div>
    <div class="art-BlockContent-bl"></div>
    <div class="art-BlockContent-br"></div>
    <div class="art-BlockContent-tc"></div>
    <div class="art-BlockContent-bc"></div>
    <div class="art-BlockContent-cl"></div>
    <div class="art-BlockContent-cr"></div>
    <div class="art-BlockContent-cc"></div>
    <div class="art-BlockContent-body">
		<ul>
			<li class="cat-item cat-item-3"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/" title="Просмотреть все записи в рубрике «МИКРОКОНТРОЛЛЕРЫ STM32»">МИКРОКОНТРОЛЛЕРЫ STM32</a>
<ul class="children">
	<li class="cat-item cat-item-7"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/bootloader/" title="Просмотреть все записи в рубрике «Bootloader»">Bootloader</a>
</li>
	<li class="cat-item cat-item-14"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/portyi-vvoda-vyivoda/" title="Просмотреть все записи в рубрике «GPIO»">GPIO</a>
</li>
	<li class="cat-item cat-item-4"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/usart/" title="Просмотреть все записи в рубрике «USART»">USART</a>
</li>
	<li class="cat-item cat-item-5"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/dma/" title="Просмотреть все записи в рубрике «DMA»">DMA</a>
</li>
	<li class="cat-item cat-item-15"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/bkp-registryi/" title="Просмотреть все записи в рубрике «BKP»">BKP</a>
</li>
	<li class="cat-item cat-item-8"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/rtc/" title="Просмотреть все записи в рубрике «RTC»">RTC</a>
</li>
	<li class="cat-item cat-item-16"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/timer/" title="Просмотреть все записи в рубрике «TIMER»">TIMER</a>
</li>
	<li class="cat-item cat-item-21"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/spi/" title="Просмотреть все записи в рубрике «SPI»">SPI</a>
</li>
	<li class="cat-item cat-item-24"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/adc/" title="Просмотреть все записи в рубрике «ADC»">ADC</a>
</li>
	<li class="cat-item cat-item-25"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/dac/" title="Просмотреть все записи в рубрике «DAC»">DAC</a>
</li>
	<li class="cat-item cat-item-26"><a href="http://mycontroller.ru/category/mikrokontrolleryi-stm32/usb/" title="Просмотреть все записи в рубрике «USB»">USB</a>
</li>
</ul>
</li>
	<li class="cat-item cat-item-19"><a href="http://mycontroller.ru/category/vneshnie-ustroystva/" title="Просмотреть все записи в рубрике «ВНЕШНИЕ УСТРОЙСТВА»">ВНЕШНИЕ УСТРОЙСТВА</a>
<ul class="children">
	<li class="cat-item cat-item-23"><a href="http://mycontroller.ru/category/vneshnie-ustroystva/termodatchik-ds18b20/" title="Просмотреть все записи в рубрике «Термодатчик ds18b20»">Термодатчик ds18b20</a>
</li>
	<li class="cat-item cat-item-29"><a href="http://mycontroller.ru/category/vneshnie-ustroystva/enkoder/" title="Просмотреть все записи в рубрике «Энкодер»">Энкодер</a>
</li>
	<li class="cat-item cat-item-20"><a href="http://mycontroller.ru/category/vneshnie-ustroystva/karta-pamyati-sd/" title="Просмотреть все записи в рубрике «Карта памяти SD»">Карта памяти SD</a>
	<ul class="children">
	<li class="cat-item cat-item-31"><a href="http://mycontroller.ru/category/vneshnie-ustroystva/karta-pamyati-sd/rabota-s-ffatfs/" title="Просмотреть все записи в рубрике «Работа с FatFs»">Работа с FatFs</a>
</li>
	</ul>
</li>
</ul>
</li>
	<li class="cat-item cat-item-1"><a href="http://mycontroller.ru/category/bez-rubriki/" title="Просмотреть все записи в рубрике «МОИ ПРОЕКТЫ»">МОИ ПРОЕКТЫ</a>
<ul class="children">
	<li class="cat-item cat-item-6"><a href="http://mycontroller.ru/category/bez-rubriki/chasyi-na-stm32f100rb/" title="Просмотреть все записи в рубрике «Часы на STM32F100RB»">Часы на STM32F100RB</a>
</li>
	<li class="cat-item cat-item-28"><a href="http://mycontroller.ru/category/bez-rubriki/umnyiy-dom/" title="Просмотреть все записи в рубрике «Умный Дом»">Умный Дом</a>
</li>
	<li class="cat-item cat-item-30"><a href="http://mycontroller.ru/category/bez-rubriki/waveplayer/" title="Просмотреть все записи в рубрике «WavePlayer»">WavePlayer</a>
</li>
</ul>
</li>
	<li class="cat-item cat-item-10"><a href="http://mycontroller.ru/category/poleznyiy-soft/" title="Просмотреть все записи в рубрике «ПОЛЕЗНЫЙ СОФТ»">ПОЛЕЗНЫЙ СОФТ</a>
<ul class="children">
	<li class="cat-item cat-item-11"><a href="http://mycontroller.ru/category/poleznyiy-soft/stm32-generator-koda/" title="Просмотреть все записи в рубрике «STM32 генератор»">STM32 генератор</a>
</li>
</ul>
</li>
		</ul>
		
		<div class="cleared"></div>
    </div>
</div>

		<div class="cleared"></div>
    </div>
</div>
</div>		<div id="recent-posts-2" class="widget widget_recent_entries"><div class="art-Block">
    <div class="art-Block-body">
		<div class="art-BlockHeader">
    <div class="l"></div>
    <div class="r"></div>
    <div class="art-header-tag-icon">
        <div class="t">Свежие записи</div>
    </div>
</div><div class="art-BlockContent">
    <div class="art-BlockContent-tl"></div>
    <div class="art-BlockContent-tr"></div>
    <div class="art-BlockContent-bl"></div>
    <div class="art-BlockContent-br"></div>
    <div class="art-BlockContent-tc"></div>
    <div class="art-BlockContent-bc"></div>
    <div class="art-BlockContent-cl"></div>
    <div class="art-BlockContent-cr"></div>
    <div class="art-BlockContent-cc"></div>
    <div class="art-BlockContent-body">
		<ul>
				<li><a href="http://mycontroller.ru/stm32-generator-koda-novaya-versiya/" title="STM32 Генератор кода. Новая версия">STM32 Генератор кода. Новая версия</a></li>
				<li><a href="http://mycontroller.ru/stm32-generator-koda-konstruktor-komponentov/" title="STM32 “Конструктор компонентов” для “Генератора кода”">STM32 “Конструктор компонентов” для “Генератора кода”</a></li>
				<li><a href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-rasshirenie-vozmozhnostey-programmyi/" title="STM32 Воспроизведение звука. Расширение возможностей программы">STM32 Воспроизведение звука. Расширение возможностей программы</a></li>
				<li><a href="http://mycontroller.ru/stm32-vosproizvedenie-zvuka-nastroyka-dac/" title="STM32 Воспроизведение звука. Настройка периферии + первый звук">STM32 Воспроизведение звука. Настройка периферии + первый звук</a></li>
				<li><a href="http://mycontroller.ru/stm32-dac-primeryi-ispolzovaniya/" title="STM32 DAC Примеры использования">STM32 DAC Примеры использования</a></li>
				</ul>
		
		<div class="cleared"></div>
    </div>
</div>

		<div class="cleared"></div>
    </div>
</div>
</div><div id="text-5" class="widget widget_text"><div class="art-Block">
    <div class="art-Block-body">
<div class="art-BlockHeader">
    <div class="l"></div>
    <div class="r"></div>
    <div class="art-header-tag-icon">
        <div class="t">Немного рекламы</div>
    </div>
</div><div class="art-BlockContent">
    <div class="art-BlockContent-tl"></div>
    <div class="art-BlockContent-tr"></div>
    <div class="art-BlockContent-bl"></div>
    <div class="art-BlockContent-br"></div>
    <div class="art-BlockContent-tc"></div>
    <div class="art-BlockContent-bc"></div>
    <div class="art-BlockContent-cl"></div>
    <div class="art-BlockContent-cr"></div>
    <div class="art-BlockContent-cc"></div>
    <div class="art-BlockContent-body">
			<div class="textwidget"><script type="text/javascript"><!--
google_ad_client = "ca-pub-6213925206017237";
/* second */
google_ad_slot = "7273021636";
google_ad_width = 200;
google_ad_height = 200;
//-->
</script>
<script type="text/javascript" src="./STM32 SD Card. Инициализация и использование карты памяти_files/show_ads.js">
</script><ins style="display:inline-table;border:none;height:200px;margin:0;padding:0;position:relative;visibility:visible;width:200px"><ins id="aswift_0_anchor" style="display:block;border:none;height:200px;margin:0;padding:0;position:relative;visibility:visible;width:200px"><iframe allowtransparency="true" frameborder="0" height="200" hspace="0" marginwidth="0" marginheight="0" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){w.location.replace(h)}}" scrolling="no" vspace="0" width="200" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;"></iframe></ins></ins></div>
		
		<div class="cleared"></div>
    </div>
</div>

		<div class="cleared"></div>
    </div>
</div>
</div>

<p align="center">

</p>

</div>
</div>
<div class="cleared"></div>

<div class="art-Footer">
    <div class="art-Footer-inner">
                <div class="art-Footer-text">
<p>
<a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#">Contact Us</a> | <a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#">Terms of Use</a> | <a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#">Trademarks</a> | <a href="http://mycontroller.ru/stm32-sd-card-initsializatsiya-i-ispolzovanie-kartyi-pamyati/#">Privacy Statement</a><br>Copyright © 2009 My Controller. All Rights Reserved.</p>
</div>
    </div>
    <div class="art-Footer-background">
    </div>
</div>

		<div class="cleared"></div>
    </div>
</div>
<div class="cleared"></div>
<p class="art-page-footer">Powered by <a href="http://wordpress.org/">WordPress</a> and <a href="http://www.artisteer.com/?p=wordpress_themes">WordPress Theme</a> created with Artisteer.</p>
</div>

<!-- 24 запросов. 0,413 секунд. -->
<div>
<!-- SyntaxHighlighter Stuff -->
<script type="text/javascript" src="./STM32 SD Card. Инициализация и использование карты памяти_files/shCore.js"></script>
<script type="text/javascript">
	SyntaxHighlighter.all();
</script>

</div>


</body></html>